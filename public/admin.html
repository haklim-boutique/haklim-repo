<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haklim Fashions - Admin Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --cream: #F8F4E9;
            --taupe: #D8CFC6;
            --charcoal: #2D2D2D;
            --soft-black: #1A1A1A;
            --gold: #C8B687;
            --light-gold: #E8DDB5;
            --dark-gold: #A8956A;
            --transition: all 0.3s ease;
            --toast-success: #4CAF50;
            --toast-error: #F44336;
            --toast-info: #2196F3;
            --toast-warning: #FF9800;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: var(--charcoal);
        }

        .admin-container {
            display: flex;
            min-height: 100vh;
            position: relative;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: var(--soft-black);
            color: white;
            padding: 1.5rem 0;
            transition: var(--transition);
            position: fixed;
            height: 100vh;
            z-index: 1000;
            left: 0;
            top: 0;
        }

        .sidebar-header {
            padding: 0 1.5rem 1.5rem;
            border-bottom: 1px solid rgba(216, 207, 198, 0.2);
        }

        .sidebar-header h2 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .sidebar-header p {
            color: var(--taupe);
            font-size: 0.9rem;
        }

        .sidebar-menu {
            margin-top: 1.5rem;
        }

        .menu-item {
            padding: 0.8rem 1.5rem;
            display: flex;
            align-items: center;
            color: var(--taupe);
            text-decoration: none;
            transition: var(--transition);
        }

        .menu-item i {
            margin-right: 0.8rem;
            width: 20px;
            text-align: center;
        }

        .menu-item:hover, .menu-item.active {
            color: white;
            background-color: rgba(200, 182, 135, 0.1);
            border-left: 3px solid var(--gold);
        }

        .menu-item.active {
            color: var(--gold);
        }

        /* Hamburger Menu */
        .hamburger {
            display: none;
            cursor: pointer;
            padding: 0.5rem;
            margin-right: 1rem;
        }

        .hamburger i {
            font-size: 1.5rem;
            color: var(--charcoal);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            overflow-x: hidden;
            margin-left: 250px;
            transition: var(--transition);
        }

        /* Top Navigation */
        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .search-bar {
            display: flex;
            align-items: center;
            background-color: #f0f0f0;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            width: 300px;
        }

        .search-bar input {
            border: none;
            background: transparent;
            padding: 0.3rem;
            width: 100%;
            outline: none;
        }

        .user-menu {
            display: flex;
            align-items: center;
        }

        .user-menu img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-left: 1rem;
        }

        .notification-badge {
            position: relative;
            margin-right: 1rem;
        }

        .notification-badge i {
            font-size: 1.2rem;
        }

        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--gold);
            color: var(--soft-black);
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Content Sections */
        .content-section {
            display: none;
            padding: 1.5rem;
        }

        .content-section.active {
            display: block;
        }

        /* Dashboard Content */
        .page-title {
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title h1 {
            font-size: 1.8rem;
            color: var(--soft-black);
        }

        .btn {
            padding: 0.6rem 1.2rem;
            background-color: var(--gold);
            color: var(--soft-black);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            position: relative;
        }

        .btn.loading {
            pointer-events: none;
            opacity: 0.7;
        }

        .btn.loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            margin: auto;
            border: 3px solid transparent;
            border-top-color: var(--soft-black);
            border-radius: 50%;
            animation: button-loading-spinner 1s ease infinite;
        }

        @keyframes button-loading-spinner {
            from {
                transform: rotate(0turn);
            }
            to {
                transform: rotate(1turn);
            }
        }

        .btn:hover {
            background-color: var(--dark-gold);
        }

        .btn-secondary {
            background-color: var(--taupe);
            color: var(--soft-black);
        }

        .btn-secondary:hover {
            background-color: #c9c0b7;
        }

        .btn-danger {
            background-color: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background-color: #bb2d3b;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background-color: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }

        .stat-card h3 {
            font-size: 0.9rem;
            color: var(--taupe);
            margin-bottom: 0.5rem;
        }

        .stat-card .value {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .stat-card .change {
            font-size: 0.8rem;
            color: #4CAF50;
        }

        .stat-card .change.negative {
            color: #F44336;
        }

        .stat-card .icon {
            position: absolute;
            right: 1.5rem;
            top: 1.5rem;
            font-size: 2rem;
            opacity: 0.2;
        }

        /* Tables */
        .table-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            overflow: auto;
            margin-bottom: 2rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }

        th {
            background-color: #f9f9f9;
            font-weight: 600;
            color: var(--soft-black);
        }

        tr:hover {
            background-color: #f9f9f9;
        }

        .status {
            padding: 0.3rem 0.6rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status.pending {
            background-color: #FFF3E0;
            color: #E65100;
        }

        .status.completed {
            background-color: #E8F5E9;
            color: #2E7D32;
        }

        .status.shipped {
            background-color: #E3F2FD;
            color: #1565C0;
        }

        .status.active {
            background-color: #E8F5E9;
            color: #2E7D32;
        }

        .status.inactive {
            background-color: #FFEBEE;
            color: #C62828;
        }

        .status.processing {
            background-color: #FFF8E1;
            color: #F57F17;
        }

        .action-btn {
            padding: 0.3rem 0.6rem;
            background-color: transparent;
            border: 1px solid var(--taupe);
            border-radius: 4px;
            cursor: pointer;
            transition: var(--transition);
            margin-right: 0.3rem;
        }

        .action-btn:hover {
            background-color: var(--gold);
            border-color: var(--gold);
            color: white;
        }

        /* Charts */
        .chart-container {
            background-color: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
            height: 350px;
            position: relative;
        }

        .chart-container h3 {
            margin-bottom: 1rem;
        }

        /* Filters */
        .filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
        }

        .filter-group label {
            margin-right: 0.5rem;
            font-size: 0.9rem;
            color: var(--charcoal);
        }

        .filter-group select, 
        .filter-group input {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
        }

        /* Form Styles */
        .form-container {
            background-color: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .form-group textarea {
            min-height: 100px;
        }

        .form-row {
            display: flex;
            gap: 1.5rem;
        }

        .form-row .form-group {
            flex: 1;
        }

        /* Media Upload */
        .media-upload {
            border: 2px dashed #ddd;
            padding: 2rem;
            text-align: center;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 1rem;
        }

        .media-upload:hover {
            border-color: var(--gold);
        }

        .media-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
        }

        .media-preview {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 4px;
            overflow: hidden;
        }

        .media-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .media-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .media-preview .remove-media {
            position: absolute;
            top: 0.2rem;
            right: 0.2rem;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        /* Features List */
        .features-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .feature-tag {
            background-color: var(--cream);
            padding: 0.3rem 0.6rem;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
        }

        .feature-tag .remove-feature {
            margin-left: 0.3rem;
            color: var(--taupe);
            cursor: pointer;
        }

        /* Variants Section */
        .variants-section {
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: #f9f9f9;
            border-radius: 4px;
        }

        .variants-section h4 {
            margin-bottom: 1rem;
        }

        .variant-option {
            margin-bottom: 1rem;
        }

        .variant-values {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .variant-value-tag {
            background-color: var(--cream);
            padding: 0.3rem 0.6rem;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
        }

        .variant-value-tag .remove-value {
            margin-left: 0.3rem;
            color: var(--taupe);
            cursor: pointer;
        }

        .add-variant-btn {
            margin-top: 0.5rem;
        }

        /* Color Variants Section */
        .color-variants {
            margin-top: 1rem;
        }

        .color-variant {
            background-color: white;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            border: 1px solid #eee;
        }

        .color-variant-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .color-variant-name {
            font-weight: 500;
        }

        .color-variant-sizes {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .size-tag {
            background-color: var(--cream);
            padding: 0.3rem 0.6rem;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
        }

        .size-tag .remove-size {
            margin-left: 0.3rem;
            color: var(--taupe);
            cursor: pointer;
        }

        .add-size-container {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: white;
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            animation: modalFadeIn 0.3s;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.3rem;
            color: var(--soft-black);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--taupe);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        /* Product View Modal */
        .product-view-modal .modal-content {
            max-width: 900px;
        }

        .product-view-container {
            display: flex;
            gap: 2rem;
        }

        .product-view-images {
            flex: 1;
            min-width: 300px;
        }

        .product-view-main-image {
            width: 100%;
            height: 400px;
            object-fit: contain;
            background-color: #f9f9f9;
            border-radius: 4px;
            margin-bottom: 1rem;
        }

        .product-view-thumbnails {
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
        }

        .product-view-thumbnail {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 4px;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .product-view-thumbnail.active {
            border-color: var(--gold);
        }

        .product-view-details {
            flex: 1;
        }

        .product-view-title {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .product-view-price {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .product-view-original-price {
            text-decoration: line-through;
            color: var(--taupe);
            margin-right: 0.5rem;
        }

        .product-view-discount {
            color: #dc3545;
            font-weight: 500;
        }

        .product-view-badge {
            display: inline-block;
            background-color: var(--gold);
            color: var(--soft-black);
            padding: 0.3rem 0.8rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 1rem;
        }

        .product-view-meta {
            margin-bottom: 1.5rem;
        }

        .product-view-meta p {
            margin-bottom: 0.5rem;
            color: var(--charcoal);
        }

        .product-view-meta strong {
            color: var(--soft-black);
        }

        .product-view-features {
            margin-bottom: 1.5rem;
        }

        .product-view-features h4 {
            margin-bottom: 0.5rem;
        }

        .product-view-features ul {
            padding-left: 1.5rem;
        }

        .product-view-features li {
            margin-bottom: 0.3rem;
        }

        .product-view-description {
            margin-bottom: 1.5rem;
        }

        .product-view-description h4 {
            margin-bottom: 0.5rem;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 7000;
        }

        .toast {
            padding: 1rem 1.5rem;
            border-radius: 4px;
            color: white;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-width: 300px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            animation: toastSlideIn 0.3s, toastSlideOut 0.3s 2.7s;
            transform: translateX(100%);
            opacity: 0;
        }

        .toast.show {
            animation: toastSlideIn 0.3s forwards;
        }

        .toast.hide {
            animation: toastSlideOut 0.3s forwards;
        }

        @keyframes toastSlideIn {
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes toastSlideOut {
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        .toast.success {
            background-color: var(--toast-success);
        }

        .toast.error {
            background-color: var(--toast-error);
        }

        .toast.info {
            background-color: var(--toast-info);
        }

        .toast.warning {
            background-color: var(--toast-warning);
        }

        .toast-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            margin-left: 1rem;
            font-size: 1.2rem;
        }

        /* Order Progress */
        .order-progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            position: relative;
        }

        .order-progress::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: #eee;
            z-index: 1;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 2;
        }

        .progress-step.active .step-icon {
            background-color: var(--gold);
            color: var(--soft-black);
            border-color: var(--gold);
        }

        .progress-step.completed .step-icon {
            background-color: var(--gold);
            color: var(--soft-black);
            border-color: var(--gold);
        }

        .step-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: white;
            border: 2px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.5rem;
            transition: var(--transition);
        }

        .step-label {
            font-size: 0.8rem;
            color: var(--taupe);
        }

        .progress-step.active .step-label,
        .progress-step.completed .step-label {
            color: var(--charcoal);
            font-weight: 500;
        }

        /* Settings Section */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .settings-card {
            background-color: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .settings-card h3 {
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #eee;
        }

        .settings-option {
            margin-bottom: 1rem;
        }

        .settings-option label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--gold);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        /* Empty State */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            text-align: center;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .empty-state i {
            font-size: 3rem;
            color: var(--taupe);
            margin-bottom: 1rem;
        }

        .empty-state h3 {
            color: var(--charcoal);
            margin-bottom: 0.5rem;
        }

        .empty-state p {
            color: var(--taupe);
            max-width: 400px;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .hamburger {
                display: block;
            }

            .product-view-container {
                flex-direction: column;
            }

            .product-view-images {
                min-width: auto;
            }
        }

        @media (max-width: 768px) {
            .search-bar {
                width: 200px;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 576px) {
            .search-bar {
                display: none;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .filters {
                flex-direction: column;
                gap: 0.5rem;
            }

            .filter-group {
                width: 100%;
            }

            .filter-group select,
            .filter-group input {
                width: 100%;
            }

            .modal-content {
                width: 95%;
            }

            .modal-footer {
                flex-direction: column;
                gap: 0.5rem;
            }

            .modal-footer .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>Haklim Fashions</h2>
                <p>Admin Panel</p>
            </div>
            <div class="sidebar-menu">
                <a href="#" class="menu-item active" data-section="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="menu-item" data-section="products">
                    <i class="fas fa-shopping-bag"></i>
                    <span>Products</span>
                </a>
                <a href="#" class="menu-item" data-section="orders">
                    <i class="fas fa-truck"></i>
                    <span>Orders</span>
                </a>
                <a href="#" class="menu-item" data-section="analytics">
                    <i class="fas fa-chart-line"></i>
                    <span>Analytics</span>
                </a>
                <a href="#" class="menu-item" data-section="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Navigation -->
            <div class="top-nav">
                <div class="hamburger">
                    <i class="fas fa-bars"></i>
                </div>
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search...">
                </div>
                <div class="user-menu">
                    <div class="notification-badge">
                        <i class="fas fa-bell"></i>
                        <span class="badge">3</span>
                    </div>
                    <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="Admin User">
                </div>
            </div>

            <!-- Content Sections -->
            <!-- Dashboard Section -->
            <div class="content-section active" id="dashboard">
                <div class="page-title">
                    <h1>Dashboard Overview</h1>
                    <button class="btn">Generate Report</button>
                </div>

                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-dollar-sign icon"></i>
                        <h3>Total Revenue</h3>
                        <div class="value" id="totalRevenue">$0</div>
                        <div class="change" id="revenueChange">Loading...</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-shopping-cart icon"></i>
                        <h3>New Orders</h3>
                        <div class="value" id="newOrders">0</div>
                        <div class="change" id="ordersChange">Loading...</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-box-open icon"></i>
                        <h3>Products Sold</h3>
                        <div class="value" id="productsSold">0</div>
                        <div class="change" id="productsChange">Loading...</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-users icon"></i>
                        <h3>New Customers</h3>
                        <div class="value" id="newCustomers">0</div>
                        <div class="change" id="customersChange">Loading...</div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="form-row">
                    <div class="chart-container">
                        <h3>Sales Performance</h3>
                        <canvas id="salesChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Top Categories</h3>
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="page-title">
                    <h1>Recent Activity</h1>
                </div>

                <div class="table-container" id="recentActivityContainer">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>

            <!-- Products Section -->
            <div class="content-section" id="products">
                <div class="page-title">
                    <h1>Product Management</h1>
                    <button class="btn" id="addProductBtn">Add Product</button>
                </div>

                <!-- Filters -->
                <div class="filters">
                    <div class="filter-group">
                        <label for="productStatus">Status:</label>
                        <select id="productStatus">
                            <option value="all">All</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="outofstock">Out of Stock</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="productCategory">Category:</label>
                        <select id="productCategory">
                            <option value="all">All</option>
                            <option value="clothing">Clothing</option>
                            <option value="footwear">Footwear</option>
                            <option value="jewellery">Jewellery</option>
                            <option value="accessories">Accessories</option>
                            <option value="beauty-personal-care">Beauty & Personal Care</option>
                            <option value="home-gifts">Home & Gifts</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="productSearch">Search:</label>
                        <input type="text" id="productSearch" placeholder="Product name...">
                    </div>
                </div>

                <div class="table-container" id="productsTableContainer">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>

            <!-- Orders Section -->
            <div class="content-section" id="orders">
                <div class="page-title">
                    <h1>Order Management</h1>
                    <button class="btn" id="exportOrdersBtn">Export Orders</button>
                </div>

                <!-- Filters -->
                <div class="filters">
                    <div class="filter-group">
                        <label for="orderStatus">Status:</label>
                        <select id="orderStatus">
                            <option value="all">All</option>
                            <option value="pending">Pending</option>
                            <option value="processing">Processing</option>
                            <option value="shipped">Shipped</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="orderDate">Date:</label>
                        <select id="orderDate">
                            <option value="all">All Time</option>
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                            <option value="year">This Year</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="orderSearch">Search:</label>
                        <input type="text" id="orderSearch" placeholder="Order ID, customer or transaction...">
                    </div>
                </div>

                <div class="table-container" id="ordersTableContainer">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>

            <!-- Analytics Section -->
            <div class="content-section" id="analytics">
                <div class="page-title">
                    <h1>Business Analytics</h1>
                    <div>
                        <button class="btn" id="exportAnalyticsBtn">Export Data</button>
                        <button class="btn btn-secondary" id="refreshAnalyticsBtn">Refresh</button>
                    </div>
                </div>

                <!-- Date Range Selector -->
                <div class="filters">
                    <div class="filter-group">
                        <label for="analyticsRange">Date Range:</label>
                        <select id="analyticsRange">
                            <option value="7days">Last 7 Days</option>
                            <option value="month">This Month</option>
                            <option value="year">This Year</option>
                        </select>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Visitors</h3>
                        <div class="value" id="totalVisitors">0</div>
                        <div class="change" id="visitorsChange">Loading...</div>
                    </div>
                    <div class="stat-card">
                        <h3>Conversion Rate</h3>
                        <div class="value" id="conversionRate">0%</div>
                        <div class="change" id="conversionChange">Loading...</div>
                    </div>
                    <div class="stat-card">
                        <h3>Avg. Order Value</h3>
                        <div class="value" id="avgOrderValue">$0</div>
                        <div class="change" id="avgOrderChange">Loading...</div>
                    </div>
                    <div class="stat-card">
                        <h3>Returning Customers</h3>
                        <div class="value" id="returningCustomers">0</div>
                        <div class="change" id="returningChange">Loading...</div>
                    </div>
                </div>

                <div class="chart-container">
                    <h3>Traffic Sources</h3>
                    <canvas id="trafficChart"></canvas>
                </div>

                <div class="form-row">
                    <div class="chart-container" style="flex: 1;">
                        <h3>Top Products</h3>
                        <canvas id="topProductsChart"></canvas>
                    </div>
                    <div class="chart-container" style="flex: 1;">
                        <h3>Customer Locations</h3>
                        <canvas id="locationsChart"></canvas>
                    </div>
                </div>

                <div class="page-title">
                    <h1>Sales Data</h1>
                </div>

                <div class="table-container">
                    <table id="salesTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Orders</th>
                                <th>Revenue</th>
                                <th>Products Sold</th>
                                <th>New Customers</th>
                            </tr>
                        </thead>
                        <tbody id="salesTableBody">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Settings Section -->
            <div class="content-section" id="settings">
                <div class="page-title">
                    <h1>System Settings</h1>
                </div>

                <div class="settings-grid">
                    <div class="settings-card">
                        <h3>Store Settings</h3>
                        <div class="settings-option">
                            <label>Store Status</label>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <p class="help-text">Toggle to open/close your store</p>
                        </div>
                        <div class="settings-option">
                            <label for="storeMessage">Store Message</label>
                            <textarea id="storeMessage" rows="3" placeholder="Display a message when store is closed"></textarea>
                        </div>
                        <div class="settings-option">
                            <label for="currency">Currency</label>
                            <select id="currency">
                                <option value="USD">US Dollar ($)</option>
                                <option value="EUR">Euro (€)</option>
                                <option value="GBP">British Pound (£)</option>
                            </select>
                        </div>
                        <button class="btn" style="margin-top: 1rem;">Save Store Settings</button>
                    </div>

                    <div class="settings-card">
                        <h3>Security</h3>
                        <div class="settings-option">
                            <label>Change Password</label>
                            <button class="btn" id="changePasswordBtn">Change Password</button>
                        </div>
                        <div class="settings-option">
                            <label>Two-Factor Authentication</label>
                            <label class="toggle-switch">
                                <input type="checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="settings-option">
                            <label>Login Notifications</label>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3>Payment Methods</h3>
                        <div class="settings-option">
                            <label>Credit/Debit Cards</label>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="settings-option">
                            <label>PayPal</label>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="settings-option">
                            <label>Bank Transfer</label>
                            <label class="toggle-switch">
                                <input type="checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="settings-option">
                            <label>Cash on Delivery</label>
                            <label class="toggle-switch">
                                <input type="checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <button class="btn" style="margin-top: 1rem;">Save Payment Settings</button>
                    </div>

                    <div class="settings-card">
                        <h3>Shipping Options</h3>
                        <div class="settings-option">
                            <label>Standard Shipping</label>
                            <input type="number" placeholder="Price" value="5.99">
                        </div>
                        <div class="settings-option">
                            <label>Express Shipping</label>
                            <input type="number" placeholder="Price" value="12.99">
                        </div>
                        <div class="settings-option">
                            <label>Free Shipping Threshold</label>
                            <input type="number" placeholder="Order amount" value="100">
                        </div>
                        <button class="btn" style="margin-top: 1rem;">Save Shipping Settings</button>
                    </div>

                    <div class="settings-card">
                        <h3>Tax Settings</h3>
                        <div class="settings-option">
                            <label>Tax Rate (%)</label>
                            <input type="number" placeholder="Tax rate" value="8.5">
                        </div>
                        <div class="settings-option">
                            <label>Tax Inclusive Pricing</label>
                            <label class="toggle-switch">
                                <input type="checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <button class="btn" style="margin-top: 1rem;">Save Tax Settings</button>
                    </div>

                    <div class="settings-card">
                        <h3>Notifications</h3>
                        <div class="settings-option">
                            <label>Email Notifications</label>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="settings-option">
                            <label>SMS Notifications</label>
                            <label class="toggle-switch">
                                <input type="checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="settings-option">
                            <label>New Order Alerts</label>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="settings-option">
                            <label>Low Stock Alerts</label>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <button class="btn" style="margin-top: 1rem;">Save Notification Settings</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div class="modal" id="addProductModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Product</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addProductForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="addProductCategory">Category</label>
                            <select id="addProductCategory" required>
                                <option value="">Select Category</option>
                                <option value="clothing">Clothing</option>
                                <option value="footwear">Footwear</option>
                                <option value="jewellery">Jewellery</option>
                                <option value="accessories">Accessories</option>
                                <option value="beauty-personal-care">Beauty & Personal Care</option>
                                <option value="home-gifts">Home & Gifts</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="addProductSubcategory">Subcategory</label>
                            <select id="addProductSubcategory" required disabled>
                                <option value="">Select Subcategory</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="addProductClass">Class</label>
                        <select id="addProductClass" required disabled>
                            <option value="">Select Class</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="addProductBrand">Brand</label>
                        <select id="addProductBrand" required disabled>
                            <option value="">Select Brand</option>
                        </select>
                        <input type="text" id="addOtherBrandInput" placeholder="Enter brand name" style="margin-top: 0.5rem; display: none;">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="addProductName">Product Name</label>
                            <input type="text" id="addProductName" required>
                        </div>
                        <div class="form-group">
                            <label for="addProductPrice">Price ($)</label>
                            <input type="number" id="addProductPrice" min="0" step="0.01" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="addProductDiscount">Discount (%)</label>
                            <input type="number" id="addProductDiscount" min="0" max="100" value="0">
                        </div>
                        <div class="form-group">
                            <label for="addProductStock">Stock Quantity</label>
                            <input type="number" id="addProductStock" min="0" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="addProductStatus">Status</label>
                        <select id="addProductStatus" required>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="addProductBadge">Badge</label>
                        <select id="addProductBadge">
                            <option value="">None</option>
                            <option value="new">New Arrival</option>
                            <option value="sale">Sale</option>
                            <option value="bestseller">Best Seller</option>
                            <option value="limited">Limited Edition</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Features</label>
                        <div class="features-list" id="addFeaturesList">
                            <!-- Features will be added here -->
                        </div>
                        <input type="hidden" id="addProductFeatures">
                        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                            <input type="text" id="addFeatureInput" placeholder="Enter feature">
                            <button type="button" class="btn btn-secondary" id="addFeatureBtn">Add</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="addProductDescription">Description</label>
                        <textarea id="addProductDescription" rows="4"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Product Images (Max 7)</label>
                        <div class="media-upload" id="addImageUploadArea">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; margin-bottom: 1rem; color: var(--taupe);"></i>
                            <p>Drag & drop images here or click to browse</p>
                            <input type="file" id="addProductImages" multiple accept="image/*" style="display: none;">
                        </div>
                        <div class="media-preview-container" id="addImagesPreviewContainer">
                            <!-- Image previews will be shown here -->
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Product Video (Optional)</label>
                        <div class="media-upload" id="addVideoUploadArea">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; margin-bottom: 1rem; color: var(--taupe);"></i>
                            <p>Drag & drop video here or click to browse</p>
                            <input type="file" id="addProductVideo" accept="video/*" style="display: none;">
                        </div>
                        <div class="media-preview-container" id="addVideoPreviewContainer">
                            <!-- Video preview will be shown here -->
                        </div>
                    </div>
                    <div class="variants-section">
                        <h4>Product Variants</h4>
                        <div class="form-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="addHasVariantsToggle">
                                <span class="toggle-slider"></span>
                                <!--<span style="margin-left: 0.5rem;">This product has variants (color, size, etc.)</span> -->
                            </label>
                        </div>
                        <div id="addVariantsContainer" style="display: none;">
                            <div class="form-group">
                                <label>Add Color Variant</label>
                                <input type="hidden" id="addProductVariants">
                                <div style="display: flex; gap: 0.5rem;">
                                    <input type="text" id="addColorNameInput" placeholder="Color name (e.g. Red)">
                                    <button type="button" class="btn btn-secondary" id="addColorBtn">Add Color</button>
                                </div>
                            </div>
                            <div class="color-variants" id="addColorVariantsContainer">
                                <!-- Color variants will be added here -->
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Cancel</button>
                <button class="btn" id="saveNewProductBtn">Save Product</button>
            </div>
        </div>
    </div>

    <!-- Edit Product Modal -->
    <div class="modal" id="editProductModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Product</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editProductForm">
                    <input type="hidden" id="editProductId">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editProductCategory">Category</label>
                            <select id="editProductCategory" required disabled>
                                <option value="">Select Category</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editProductSubcategory">Subcategory</label>
                            <select id="editProductSubcategory" required disabled>
                                <option value="">Select Subcategory</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="editProductClass">Class</label>
                        <select id="editProductClass" required disabled>
                            <option value="">Select Class</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editProductBrand">Brand</label>
                        <select id="editProductBrand" required disabled>
                            <option value="">Select Brand</option>
                        </select>
                        <input type="text" id="editOtherBrandInput" placeholder="Enter brand name" style="margin-top: 0.5rem; display: none;">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editProductName">Product Name</label>
                            <input type="text" id="editProductName" required>
                        </div>
                        <div class="form-group">
                            <label for="editProductPrice">Price ($)</label>
                            <input type="number" id="editProductPrice" min="0" step="0.01" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editProductDiscount">Discount (%)</label>
                            <input type="number" id="editProductDiscount" min="0" max="100" value="0">
                        </div>
                        <div class="form-group">
                            <label for="editProductStock">Stock Quantity</label>
                            <input type="number" id="editProductStock" min="0" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="editProductStatus">Status</label>
                        <select id="editProductStatus" required>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editProductBadge">Badge</label>
                        <select id="editProductBadge">
                            <option value="">None</option>
                            <option value="new">New Arrival</option>
                            <option value="sale">Sale</option>
                            <option value="bestseller">Best Seller</option>
                            <option value="limited">Limited Edition</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Features</label>
                        <div class="features-list" id="editFeaturesList">
                            <!-- Features will be added here -->
                        </div>
                        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                            <input type="text" id="editFeatureInput" placeholder="Enter feature">
                            <button type="button" class="btn btn-secondary" id="editAddFeatureBtn">Add</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="editProductDescription">Description</label>
                        <textarea id="editProductDescription" rows="4"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Product Images (Max 7)</label>
                        <div class="media-upload" id="editImageUploadArea">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; margin-bottom: 1rem; color: var(--taupe);"></i>
                            <p>Drag & drop images here or click to browse</p>
                            <input type="file" id="editProductImages" multiple accept="image/*" style="display: none;">
                        </div>
                        <div class="media-preview-container" id="editImagesPreviewContainer">
                            <!-- Existing and new image previews will be shown here -->
                        </div>
                        <input type="hidden" id="deletedImages">
                    </div>
                    <div class="form-group">
                        <label>Product Video (Optional)</label>
                        <div class="media-upload" id="editVideoUploadArea">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; margin-bottom: 1rem; color: var(--taupe);"></i>
                            <p>Drag & drop video here or click to browse</p>
                            <input type="file" id="editProductVideo" accept="video/*" style="display: none;">
                        </div>
                        <div class="media-preview-container" id="editVideoPreviewContainer">
                            <!-- Video preview will be shown here -->
                        </div>
                        <input type="hidden" id="deletedVideo">
                    </div>
                    <div class="variants-section">
                        <h4>Product Variants</h4>
                        <div class="form-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="editHasVariantsToggle">
                                <span class="toggle-slider"></span>
                                <span style="margin-left: 0.5rem;">This product has variants (color, size, etc.)</span>
                            </label>
                        </div>
                        <div id="editVariantsContainer" style="display: none;">
                            <div class="form-group">
                                <label>Add Color Variant</label>
                                <div style="display: flex; gap: 0.5rem;">
                                    <input type="text" id="editColorNameInput" placeholder="Color name (e.g. Red)">
                                    <button type="button" class="btn btn-secondary" id="editAddColorBtn">Add Color</button>
                                </div>
                            </div>
                            <div class="color-variants" id="editColorVariantsContainer">
                                <!-- Color variants will be added here -->
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Cancel</button>
                <button class="btn" id="saveEditedProductBtn">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Product View Modal -->
    <div class="modal product-view-modal" id="productViewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Product Details</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="product-view-container" id="productViewContainer">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Close</button>
                <button class="btn" id="editProductBtn">Edit Product</button>
            </div>
        </div>
    </div>

    <!-- Order Modal -->
    <div class="modal" id="orderModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Order Details</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="order-progress">
                    <div class="progress-step completed">
                        <div class="step-icon">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="step-label">Order Placed</div>
                    </div>
                    <div class="progress-step active">
                        <div class="step-icon">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div class="step-label">Processing</div>
                    </div>
                    <div class="progress-step">
                        <div class="step-icon">
                            <i class="fas fa-truck"></i>
                        </div>
                        <div class="step-label">Shipped</div>
                    </div>
                    <div class="progress-step">
                        <div class="step-icon">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="step-label">Delivered</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <h4>Order Information</h4>
                        <p><strong>Order ID:</strong> <span id="modalOrderId">#ORD-2023-001</span></p>
                        <p><strong>Date:</strong> <span id="modalOrderDate">Jun 12, 2023</span></p>
                        <p><strong>Status:</strong> <span id="modalOrderStatus" class="status processing">Processing</span></p>
                        <p><strong>Payment Method:</strong> <span id="modalPaymentMethod">Credit Card</span></p>
                        <p><strong>Transaction ID:</strong> <span id="modalTransactionId">TXN-789456123</span></p>
                    </div>
                    <div class="form-group">
                        <h4>Customer Information</h4>
                        <p><strong>Name:</strong> <span id="modalCustomerName">Sarah Johnson</span></p>
                        <p><strong>Email:</strong> <span id="modalCustomerEmail">sarah.johnson@example.com</span></p>
                        <p><strong>Phone:</strong> <span id="modalCustomerPhone">(555) 123-4567</span></p>
                    </div>
                </div>

                <div class="form-group">
                    <h4>Shipping Address</h4>
                    <p id="modalShippingAddress">123 Main St, Apt 4B, New York, NY 10001, United States</p>
                </div>

                <div class="table-container" style="margin-top: 1.5rem;">
                    <table>
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Price</th>
                                <th>Quantity</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody id="modalOrderItems">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="3" style="text-align: right;"><strong>Subtotal:</strong></td>
                                <td><strong id="modalSubtotal">$0.00</strong></td>
                            </tr>
                            <tr>
                                <td colspan="3" style="text-align: right;"><strong>Shipping:</strong></td>
                                <td><strong id="modalShipping">$0.00</strong></td>
                            </tr>
                            <tr>
                                <td colspan="3" style="text-align: right;"><strong>Tax:</strong></td>
                                <td><strong id="modalTax">$0.00</strong></td>
                            </tr>
                            <tr>
                                <td colspan="3" style="text-align: right;"><strong>Total:</strong></td>
                                <td><strong id="modalTotal">$0.00</strong></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <div class="form-group">
                    <label for="orderNotes">Order Notes</label>
                    <textarea id="orderNotes" rows="3" placeholder="Add any notes about this order..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Close</button>
                <button class="btn" id="updateOrderBtn">Update Status</button>
                <button class="btn btn-secondary" id="printInvoiceBtn">Print Invoice</button>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div class="modal" id="changePasswordModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Change Password</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="changePasswordForm">
                    <div class="form-group">
                        <label for="currentPassword">Current Password</label>
                        <input type="password" id="currentPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="newPassword">New Password</label>
                        <input type="password" id="newPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Confirm New Password</label>
                        <input type="password" id="confirmPassword" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Cancel</button>
                <button class="btn" id="savePasswordBtn">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // Global variables
        let productsData = [];
        let ordersData = [];
        let currentProductId = null;
        let currentOrderId = null;
        let charts = {};

        // Category structure with subcategories and classes
        const categoryStructure = {
            clothing: {
                subcategories: ["Women's Clothing", "Men's Clothing", "Girls' Clothing", "Boys' Clothing", "Baby Clothing"],
                classes: {
                    "Women's Clothing": ["Dresses", "Tops", "Bottoms", "Outerwear", "Loungewear", "Underwear & Intimates"],
                    "Men's Clothing": ["Shirts", "Pants", "Outerwear", "Loungewear", "Underwear & Intimates"],
                    "Girls' Clothing": ["Tops", "Dresses & Skirts", "Bottoms", "Outerwear", "Pajamas", "Underwear"],
                    "Boys' Clothing": ["Tops", "Bottoms", "Outerwear", "Pajamas", "Underwear"],
                    "Baby Clothing": ["Bodysuits", "Clothing Sets", "Pajamas", "Outerwear", "Diaper Covers"]
                }
            },
            footwear: {
                subcategories: ["Women's Footwear", "Men's Footwear", "Kids' Footwear", "Baby Footwear"],
                classes: {
                    "Women's Footwear": ["Sneakers", "Sports Shoes", "Heels", "Flats", "Boots", "Sandals"],
                    "Men's Footwear": ["Sneakers", "Sports Shoes", "Formal Shoes", "Casual Shoes", "Boots"],
                    "Kids' Footwear": ["Sneakers", "Sports Shoes", "Casual Shoes", "Slippers"],
                    "Baby Footwear": ["Booties", "Soft Shoes", "Slippers"]
                }
            },
            jewellery: {
                subcategories: ["Necklaces", "Earrings", "Bracelets", "Rings"],
                classes: {
                    "Necklaces": ["Necklaces"],
                    "Earrings": ["Earrings"],
                    "Bracelets": ["Bracelets"],
                    "Rings": ["Rings"]
                }
            },
            accessories: {
                subcategories: ["Bags", "Scarves & Wraps", "Wallets & Leather Goods", "Hats & Headwear", "Gloves & Mittens", "Hair Accessories", "Eyewear", "Belts & Ties"],
                classes: {
                    "Bags": ["Bags"],
                    "Scarves & Wraps": ["Scarves & Wraps"],
                    "Wallets & Leather Goods": ["Wallets & Leather Goods"],
                    "Hats & Headwear": ["Hats & Headwear"],
                    "Gloves & Mittens": ["Gloves & Mittens"],
                    "Hair Accessories": ["Hair Accessories"],
                    "Eyewear": ["Eyewear"],
                    "Belts & Ties": ["Belts & Ties"]
                }
            },
            "beauty-personal-care": {
                subcategories: ["Makeup", "Skincare", "Fragrance", "Hair Care", "Body Care"],
                classes: {
                    "Makeup": ["Face", "Eyes", "Lips", "Brushes & Tools"],
                    "Skincare": ["Moisturizers", "Serums", "Cleansers", "Masks"],
                    "Fragrance": ["Perfume", "Body Mist"],
                    "Hair Care": ["Shampoo", "Conditioner", "Styling Products"],
                    "Body Care": ["Lotions", "Body Oils", "Body Scrubs"]
                }
            },
            "home-gifts": {
                subcategories: ["Home Decor", "Artisanal Goods"],
                classes: {
                    "Home Decor": ["Candles", "Vases", "Throws"],
                    "Artisanal Goods": ["Ceramics", "Handwoven Baskets", "Handmade Textiles"]
                }
            }
        };

        // Brands for each class
        const brands = {
            "Dresses": ["Haklim", "Velvet Rose", "Carmine", "LunaBelle", "Marisol", "SilkAura", "Generic", "Other"],
            "Tops": ["Haklim", "Velvet Rose", "LunaBelle", "Marisol", "Generic", "Other"],
            "Bottoms": ["Haklim", "Carmine", "Marisol", "Generic", "Other"],
            "Outerwear": ["Haklim", "Velvet Rose", "Marisol", "UrbanEdge", "Generic", "Other"],
            "Loungewear": ["Haklim", "Carmine", "Generic", "Other"],
            "Underwear & Intimates": ["SilkAura", "LunaBelle", "Velvet Rose", "UrbanEdge", "Generic", "Other"],
            "Shirts": ["UrbanEdge", "Velvet Rose", "Generic", "Other"],
            "Pants": ["Haklim", "Carmine", "Generic", "Other"],
            "Dresses & Skirts": ["MiniChic", "Haklim Kids", "Generic", "Other"],
            "Pajamas": ["MiniChic", "SoftNest", "BabyLux", "Generic", "Other"],
            "Underwear": ["SoftNest", "BabyLux", "Generic", "Other"],
            "Bodysuits": ["SoftNest", "BabyLux", "Generic", "Other"],
            "Clothing Sets": ["SoftNest", "BabyLux", "Generic", "Other"],
            "Diaper Covers": ["SoftNest", "Generic", "Other"],
            "Sneakers": ["Haklim", "Stride", "UrbanEdge", "MiniChic", "Generic", "Other"],
            "Sports Shoes": ["Stride", "UrbanEdge", "Generic", "Other"],
            "Heels": ["Haklim", "LunaBelle", "Generic", "Other"],
            "Flats": ["Haklim", "LunaBelle", "Generic", "Other"],
            "Boots": ["Haklim", "Velvet Rose", "Generic", "Other"],
            "Sandals": ["Haklim", "Velvet Rose", "Generic", "Other"],
            "Formal Shoes": ["Haklim", "UrbanEdge", "Generic", "Other"],
            "Casual Shoes": ["Haklim", "UrbanEdge", "Generic", "Other"],
            "Slippers": ["SoftNest", "Generic", "Other"],
            "Booties": ["SoftNest", "BabyLux", "Generic", "Other"],
            "Soft Shoes": ["SoftNest", "BabyLux", "Generic", "Other"],
            "Necklaces": ["JewelCraft", "LunaBelle", "Generic", "Other"],
            "Earrings": ["JewelCraft", "LunaBelle", "Generic", "Other"],
            "Bracelets": ["JewelCraft", "LunaBelle", "Generic", "Other"],
            "Rings": ["JewelCraft", "LunaBelle", "Generic", "Other"],
            "Bags": ["Haklim", "UrbanEdge", "Velvet Rose", "Generic", "Other"],
            "Scarves & Wraps": ["Haklim", "Velvet Rose", "Generic", "Other"],
            "Wallets & Leather Goods": ["Haklim", "UrbanEdge", "Generic", "Other"],
            "Hats & Headwear": ["Velvet Rose", "UrbanEdge", "Generic", "Other"],
            "Gloves & Mittens": ["Velvet Rose", "UrbanEdge", "Generic", "Other"],
            "Hair Accessories": ["LunaBelle", "Velvet Rose", "Generic", "Other"],
            "Eyewear": ["UrbanEdge", "Generic", "Other"],
            "Belts & Ties": ["Haklim", "UrbanEdge", "Generic", "Other"],
            "Face": ["Glowify", "SilkAura", "Generic", "Other"],
            "Eyes": ["Glowify", "SilkAura", "Generic", "Other"],
            "Lips": ["Glowify", "SilkAura", "Generic", "Other"],
            "Brushes & Tools": ["Glowify", "Generic", "Other"],
            "Moisturizers": ["Glowify", "SilkAura", "Generic", "Other"],
            "Serums": ["Glowify", "SilkAura", "Generic", "Other"],
            "Cleansers": ["Glowify", "SilkAura", "Generic", "Other"],
            "Masks": ["Glowify", "SilkAura", "Generic", "Other"],
            "Perfume": ["AromaLux", "SilkAura", "Generic", "Other"],
            "Body Mist": ["AromaLux", "Generic", "Other"],
            "Shampoo": ["Glowify", "SilkAura", "Generic", "Other"],
            "Conditioner": ["Glowify", "SilkAura", "Generic", "Other"],
            "Styling Products": ["Glowify", "Generic", "Other"],
            "Lotions": ["Glowify", "SilkAura", "Generic", "Other"],
            "Body Oils": ["Glowify", "SilkAura", "Generic", "Other"],
            "Body Scrubs": ["Glowify", "SilkAura", "Generic", "Other"],
            "Candles": ["HomeGlow", "ArtisanCraft", "Generic", "Other"],
            "Vases": ["HomeGlow", "ArtisanCraft", "Generic", "Other"],
            "Throws": ["HomeGlow", "ArtisanCraft", "Generic", "Other"],
            "Ceramics": ["ArtisanCraft", "Generic", "Other"],
            "Handwoven Baskets": ["ArtisanCraft", "Generic", "Other"],
            "Handmade Textiles": ["ArtisanCraft", "Generic", "Other"]
        };

        // DOM Elements
        const sidebar = document.querySelector('.sidebar');
        const hamburger = document.querySelector('.hamburger');
        const mainContent = document.querySelector('.main-content');
        const menuItems = document.querySelectorAll('.menu-item');
        const contentSections = document.querySelectorAll('.content-section');
        const addProductModal = document.getElementById('addProductModal');
        const editProductModal = document.getElementById('editProductModal');
        const productViewModal = document.getElementById('productViewModal');
        const orderModal = document.getElementById('orderModal');
        const changePasswordModal = document.getElementById('changePasswordModal');
        const addProductBtn = document.getElementById('addProductBtn');
        const saveNewProductBtn = document.getElementById('saveNewProductBtn');
        const saveEditedProductBtn = document.getElementById('saveEditedProductBtn');
        const editProductBtn = document.getElementById('editProductBtn');
        const changePasswordBtn = document.getElementById('changePasswordBtn');
        const savePasswordBtn = document.getElementById('savePasswordBtn');
        const updateOrderBtn = document.getElementById('updateOrderBtn');
        const printInvoiceBtn = document.getElementById('printInvoiceBtn');
        const modalCloseButtons = document.querySelectorAll('.modal-close');
        const productsTableContainer = document.getElementById('productsTableContainer');
        const ordersTableContainer = document.getElementById('ordersTableContainer');
        const recentActivityContainer = document.getElementById('recentActivityContainer');
        const productViewContainer = document.getElementById('productViewContainer');
        const modalOrderItems = document.getElementById('modalOrderItems');
        const toastContainer = document.getElementById('toastContainer');

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            loadInitialData();
        });

        // Set up event listeners
        function setupEventListeners() {
            // Hamburger menu toggle
            hamburger.addEventListener('click', function() {
                sidebar.classList.toggle('active');
                mainContent.classList.toggle('sidebar-active');
            });

            // Menu item clicks
            menuItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    menuItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    
                    const sectionId = this.getAttribute('data-section');
                    
                    contentSections.forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    document.getElementById(sectionId).classList.add('active');
                    
                    if (window.innerWidth <= 992) {
                        sidebar.classList.remove('active');
                    }
                    
                    if (sectionId === 'analytics') {
                        loadAnalyticsData();
                    }
                });
            });

            // Add product button
            addProductBtn.addEventListener('click', function() {
                resetAddProductForm();
                showModal(addProductModal);
            });

            // Save new product button
            saveNewProductBtn.addEventListener('click', function() {
                addProduct();
            });

            // Save edited product button
            saveEditedProductBtn.addEventListener('click', function() {
                saveProduct('edit');
            });

            // Edit product button in view modal
            editProductBtn.addEventListener('click', function() {
                if (currentProductId) {
                    hideModal(productViewModal);
                    editProduct(currentProductId);
                }
            });

            // Change password button
            changePasswordBtn?.addEventListener('click', function() {
                showModal(changePasswordModal);
            });

            // Save password button
            savePasswordBtn?.addEventListener('click', function() {
                const currentPassword = document.getElementById('currentPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                if (newPassword !== confirmPassword) {
                    showToast('New passwords do not match', 'error');
                    return;
                }
                
                showToast('Password changed successfully', 'success');
                hideModal(changePasswordModal);
                document.getElementById('changePasswordForm').reset();
            });

            // Update order status button
            updateOrderBtn.addEventListener('click', function() {
                if (currentOrderId) {
                    updateOrderStatus(currentOrderId);
                }
            });

            // Print invoice button
            printInvoiceBtn.addEventListener('click', function() {
                window.print();
            });

            // Modal close buttons
            modalCloseButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    hideModal(modal);
                });
            });

            // Click outside modal to close
            window.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    hideModal(e.target);
                }
            });

            // Product search/filter
            document.getElementById('productSearch').addEventListener('input', function() {
                renderProductsTable();
            });

            document.getElementById('productStatus').addEventListener('change', function() {
                renderProductsTable();
            });

            document.getElementById('productCategory').addEventListener('change', function() {
                renderProductsTable();
            });

            // Order search/filter
            document.getElementById('orderSearch').addEventListener('input', function() {
                renderOrdersTable();
            });

            document.getElementById('orderStatus').addEventListener('change', function() {
                renderOrdersTable();
            });

            document.getElementById('orderDate').addEventListener('change', function() {
                renderOrdersTable();
            });

            // Analytics date range change
            document.getElementById('analyticsRange').addEventListener('change', function() {
                loadAnalyticsData();
            });

            // Category selection change in add product form
            document.getElementById('addProductCategory').addEventListener('change', function() {
                const category = this.value;
                const subcategorySelect = document.getElementById('addProductSubcategory');
                subcategorySelect.innerHTML = '<option value="">Select Subcategory</option>';
                document.getElementById('addProductClass').innerHTML = '<option value="">Select Class</option>';
                document.getElementById('addProductBrand').innerHTML = '<option value="">Select Brand</option>';
                
                if (category) {
                    subcategorySelect.disabled = false;
                    
                    // Populate subcategories
                    const subcategories = categoryStructure[category]?.subcategories || [];
                    subcategories.forEach(subcategory => {
                        const option = document.createElement('option');
                        option.value = subcategory;
                        option.textContent = subcategory;
                        subcategorySelect.appendChild(option);
                    });
                } else {
                    subcategorySelect.disabled = true;
                    document.getElementById('addProductClass').disabled = true;
                    document.getElementById('addProductBrand').disabled = true;
                }
            });

            // Subcategory selection change in add product form
            document.getElementById('addProductSubcategory').addEventListener('change', function() {
                const category = document.getElementById('addProductCategory').value;
                const subcategory = this.value;
                const classSelect = document.getElementById('addProductClass');
                classSelect.innerHTML = '<option value="">Select Class</option>';
                document.getElementById('addProductBrand').innerHTML = '<option value="">Select Brand</option>';
                
                if (category && subcategory) {
                    classSelect.disabled = false;
                    
                    // Populate classes
                    const classes = categoryStructure[category]?.classes[subcategory] || [];
                    classes.forEach(cls => {
                        const option = document.createElement('option');
                        option.value = cls;
                        option.textContent = cls;
                        classSelect.appendChild(option);
                    });
                } else {
                    classSelect.disabled = true;
                    document.getElementById('addProductBrand').disabled = true;
                }
            });

            // Class selection change in add product form
            document.getElementById('addProductClass').addEventListener('change', function() {
                const productClass = this.value;
                const brandSelect = document.getElementById('addProductBrand');
                brandSelect.innerHTML = '<option value="">Select Brand</option>';
                
                if (productClass) {
                    brandSelect.disabled = false;
                    
                    // Populate brands
                    const brandOptions = brands[productClass] || [];
                    brandOptions.forEach(brand => {
                        const option = document.createElement('option');
                        option.value = brand === 'Other' ? 'other' : brand.toLowerCase().replace(/\s+/g, '_');
                        option.textContent = brand;
                        brandSelect.appendChild(option);
                    });
                } else {
                    brandSelect.disabled = true;
                }
            });

            // Brand selection change in add product form
            document.getElementById('addProductBrand').addEventListener('change', function() {
                if (this.value === 'other') {
                    document.getElementById('addOtherBrandInput').style.display = 'block';
                } else {
                    document.getElementById('addOtherBrandInput').style.display = 'none';
                }
            });

            // Add feature button in add product form
            document.getElementById('addFeatureBtn').addEventListener('click', function() {
                addFeature('add');
            });

            // Feature input enter key in add product form
            document.getElementById('addFeatureInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addFeature('add');
                }
            });

            // Add color variant button in add product form
            document.getElementById('addColorBtn').addEventListener('click', function() {
                addColorVariant('add');
            });

            // Color name input enter key in add product form
            document.getElementById('addColorNameInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addColorVariant('add');
                }
            });

            // Has variants toggle in add product form
            document.getElementById('addHasVariantsToggle').addEventListener('change', function() {
                document.getElementById('addVariantsContainer').style.display = this.checked ? 'block' : 'none';
            });

            // Image upload area click in add product form
            document.getElementById('addImageUploadArea').addEventListener('click', function() {
                document.getElementById('addProductImages').click();
            });

            // Image file input change in add product form
            document.getElementById('addProductImages').addEventListener('change', function() {
                handleImageUpload(this.files, 'add');
            });

            // Video upload area click in add product form
            document.getElementById('addVideoUploadArea').addEventListener('click', function() {
                document.getElementById('addProductVideo').click();
            });

            // Video file input change in add product form
            document.getElementById('addProductVideo').addEventListener('change', function() {
                handleVideoUpload(this.files[0], 'add');
            });

            // Drag and drop for images in add product form
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                document.getElementById('addImageUploadArea').addEventListener(eventName, preventDefaults, false);
            });

            ['dragenter', 'dragover'].forEach(eventName => {
                document.getElementById('addImageUploadArea').addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                document.getElementById('addImageUploadArea').addEventListener(eventName, unhighlight, false);
            });

            document.getElementById('addImageUploadArea').addEventListener('drop', function(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleImageUpload(files, 'add');
            });

            // Category selection change in edit product form
            document.getElementById('editProductCategory').addEventListener('change', function() {
                const category = this.value;
                const subcategorySelect = document.getElementById('editProductSubcategory');
                subcategorySelect.innerHTML = '<option value="">Select Subcategory</option>';
                document.getElementById('editProductClass').innerHTML = '<option value="">Select Class</option>';
                document.getElementById('editProductBrand').innerHTML = '<option value="">Select Brand</option>';
                
                if (category) {
                    subcategorySelect.disabled = false;
                    
                    // Populate subcategories
                    const subcategories = categoryStructure[category]?.subcategories || [];
                    subcategories.forEach(subcategory => {
                        const option = document.createElement('option');
                        option.value = subcategory;
                        option.textContent = subcategory;
                        subcategorySelect.appendChild(option);
                    });
                } else {
                    subcategorySelect.disabled = true;
                    document.getElementById('editProductClass').disabled = true;
                    document.getElementById('editProductBrand').disabled = true;
                }
            });

            // Subcategory selection change in edit product form
            document.getElementById('editProductSubcategory').addEventListener('change', function() {
                const category = document.getElementById('editProductCategory').value;
                const subcategory = this.value;
                const classSelect = document.getElementById('editProductClass');
                classSelect.innerHTML = '<option value="">Select Class</option>';
                document.getElementById('editProductBrand').innerHTML = '<option value="">Select Brand</option>';
                
                if (category && subcategory) {
                    classSelect.disabled = false;
                    
                    // Populate classes
                    const classes = categoryStructure[category]?.classes[subcategory] || [];
                    classes.forEach(cls => {
                        const option = document.createElement('option');
                        option.value = cls;
                        option.textContent = cls;
                        classSelect.appendChild(option);
                    });
                } else {
                    classSelect.disabled = true;
                    document.getElementById('editProductBrand').disabled = true;
                }
            });

            // Class selection change in edit product form
            document.getElementById('editProductClass').addEventListener('change', function() {
                const productClass = this.value;
                const brandSelect = document.getElementById('editProductBrand');
                brandSelect.innerHTML = '<option value="">Select Brand</option>';
                
                if (productClass) {
                    brandSelect.disabled = false;
                    
                    // Populate brands
                    const brandOptions = brands[productClass] || [];
                    brandOptions.forEach(brand => {
                        const option = document.createElement('option');
                        option.value = brand === 'Other' ? 'other' : brand.toLowerCase().replace(/\s+/g, '_');
                        option.textContent = brand;
                        brandSelect.appendChild(option);
                    });
                } else {
                    brandSelect.disabled = true;
                }
            });

            // Brand selection change in edit product form
            document.getElementById('editProductBrand').addEventListener('change', function() {
                if (this.value === 'other') {
                    document.getElementById('editOtherBrandInput').style.display = 'block';
                } else {
                    document.getElementById('editOtherBrandInput').style.display = 'none';
                }
            });

            // Add feature button in edit product form
            document.getElementById('editAddFeatureBtn').addEventListener('click', function() {
                addFeature('edit');
            });

            // Feature input enter key in edit product form
            document.getElementById('editFeatureInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addFeature('edit');
                }
            });

            // Add color variant button in edit product form
            document.getElementById('editAddColorBtn').addEventListener('click', function() {
                addColorVariant('edit');
            });

            // Color name input enter key in edit product form
            document.getElementById('editColorNameInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addColorVariant('edit');
                }
            });

            // Has variants toggle in edit product form
            document.getElementById('editHasVariantsToggle').addEventListener('change', function() {
                document.getElementById('editVariantsContainer').style.display = this.checked ? 'block' : 'none';
            });

            // Image upload area click in edit product form
            document.getElementById('editImageUploadArea').addEventListener('click', function() {
                document.getElementById('editProductImages').click();
            });

            // Image file input change in edit product form
            document.getElementById('editProductImages').addEventListener('change', function() {
                handleImageUpload(this.files, 'edit');
            });

            // Video upload area click in edit product form
            document.getElementById('editVideoUploadArea').addEventListener('click', function() {
                document.getElementById('editProductVideo').click();
            });

            // Video file input change in edit product form
            document.getElementById('editProductVideo').addEventListener('change', function() {
                handleVideoUpload(this.files[0], 'edit');
            });

            // Drag and drop for images in edit product form
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                document.getElementById('editImageUploadArea').addEventListener(eventName, preventDefaults, false);
            });

            ['dragenter', 'dragover'].forEach(eventName => {
                document.getElementById('editImageUploadArea').addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                document.getElementById('editImageUploadArea').addEventListener(eventName, unhighlight, false);
            });

            document.getElementById('editImageUploadArea').addEventListener('drop', function(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleImageUpload(files, 'edit');
            });
        }

        // Load initial data
        function loadInitialData() {
            fetchProducts();
            fetchOrders();
        }

        // Fetch products from server
        function fetchProducts() {
            showLoading(productsTableContainer);
            
            fetch('/crud/fetch-products')
                .then(response => response.json())
                .then(data => {
                    productsData = data;
                    renderProductsTable();
                    updateDashboardStats();
                })
                .catch(error => {
                    console.error('Error fetching products:', error);
                    showError(productsTableContainer, 'Failed to load products. Please try again.');
                });
        }

        // Fetch orders from server
        function fetchOrders() {
            showLoading(ordersTableContainer);
            
            fetch('/crud/fetch-orders')
                .then(response => response.json())
                .then(data => {
                    ordersData = data;
                    renderOrdersTable();
                    updateDashboardStats();
                    renderRecentActivity();
                })
                .catch(error => {
                    console.error('Error fetching orders:', error);
                    showError(ordersTableContainer, 'Failed to load orders. Please try again.');
                });
        }

        // Load analytics data
        function loadAnalyticsData() {
            updateAnalyticsStats();
            initCharts();
        }

        // Render products table
        function renderProductsTable() {
            const statusFilter = document.getElementById('productStatus').value;
            const categoryFilter = document.getElementById('productCategory').value;
            const searchQuery = document.getElementById('productSearch').value.toLowerCase();
            
            let filteredProducts = productsData;
            
            // Apply filters
            if (statusFilter !== 'all') {
                filteredProducts = filteredProducts.filter(product => {
                    if (statusFilter === 'outofstock') {
                        return product.stock === 0;
                    }
                    return product.status === statusFilter;
                });
            }
            
            if (categoryFilter !== 'all') {
                filteredProducts = filteredProducts.filter(product => product.category === categoryFilter);
            }
            
            if (searchQuery) {
                filteredProducts = filteredProducts.filter(product => 
                    product.name.toLowerCase().includes(searchQuery)
                );
            }
            
            // Clear table
            productsTableContainer.innerHTML = '';
            
            if (filteredProducts.length === 0) {
                showEmptyState(productsTableContainer, 'No products found', 'Try adjusting your search or filters');
                return;
            }
            
            // Create table
            const table = document.createElement('table');
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Category</th>
                        <th>Price</th>
                        <th>Stock</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="productsBody">
                    <!-- Will be populated below -->
                </tbody>
            `;
            
            const productsBody = table.querySelector('#productsBody');
            
            // Populate table
            filteredProducts.forEach(product => {
                const row = document.createElement('tr');
                
                // Determine status class and text
                let statusClass, statusText;
                if (product.status === 'active') {
                    statusClass = 'completed';
                    statusText = 'Active';
                } else if (product.status === 'inactive') {
                    statusClass = 'inactive';
                    statusText = 'Inactive';
                } else if (product.stock === 0) {
                    statusClass = 'pending';
                    statusText = 'Out of Stock';
                }
                
                // Calculate discounted price if applicable
                const discountedPrice = product.discount > 0 
                    ? product.price * (1 - product.discount / 100)
                    : null;
                
                row.innerHTML = `
                    <td>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            ${product.images && product.images.length > 0 ? 
                                `<img src="${product.images[0]}" alt="${product.name}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;">` : 
                                '<div style="width: 50px; height: 50px; background-color: #f0f0f0; border-radius: 4px; display: flex; align-items: center; justify-content: center;"><i class="fas fa-image" style="color: #ccc;"></i></div>'}
                            <div>
                                <div style="font-weight: 500;">${product.name}</div>
                                ${product.badge ? `<span class="product-badge" style="background-color: var(--gold); color: var(--soft-black); padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.7rem; display: inline-block; margin-top: 0.2rem;">${capitalizeFirstLetter(product.badge)}</span>` : ''}
                            </div>
                        </div>
                    </td>
                    <td>${product.category}</td>
                    <td>
                        ${discountedPrice 
                            ? `<span style="text-decoration: line-through; color: var(--taupe);">$${product.price.toFixed(2)}</span><br>
                               <span style="color: #dc3545; font-weight: 500;">$${discountedPrice.toFixed(2)}</span>` 
                            : `$${product.price.toFixed(2)}`}
                    </td>
                    <td>${product.stock}</td>
                    <td><span class="status ${statusClass}">${statusText}</span></td>
                    <td>
                        <button class="action-btn view-product" data-id="${product.id}"><i class="fas fa-eye"></i></button>
                        <button class="action-btn edit-product" data-id="${product.id}"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete-product" data-id="${product.id}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                
                productsBody.appendChild(row);
            });
            
            productsTableContainer.appendChild(table);
            
            // Add event listeners to action buttons
            document.querySelectorAll('.view-product').forEach(button => {
                button.addEventListener('click', function() {
                    const productId = this.getAttribute('data-id');
                    viewProduct(productId);
                });
            });
            
            document.querySelectorAll('.edit-product').forEach(button => {
                button.addEventListener('click', function() {
                    const productId = this.getAttribute('data-id');
                    editProduct(productId);
                });
            });
            
            document.querySelectorAll('.delete-product').forEach(button => {
                button.addEventListener('click', function() {
                    const productId = this.getAttribute('data-id');
                    deleteProduct(productId);
                });
            });
        }

        // Render orders table
        function renderOrdersTable() {
            const statusFilter = document.getElementById('orderStatus').value;
            const dateFilter = document.getElementById('orderDate').value;
            const searchQuery = document.getElementById('orderSearch').value.toLowerCase();
            
            let filteredOrders = ordersData;
            
            // Apply filters
            if (statusFilter !== 'all') {
                filteredOrders = filteredOrders.filter(order => order.status === statusFilter);
            }
            
            if (dateFilter !== 'all') {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                filteredOrders = filteredOrders.filter(order => {
                    const orderDate = new Date(order.order_timestamp);
                    
                    if (dateFilter === 'today') {
                        return orderDate.toDateString() === today.toDateString();
                    } else if (dateFilter === 'week') {
                        const weekStart = new Date(today);
                        weekStart.setDate(today.getDate() - today.getDay());
                        return orderDate >= weekStart;
                    } else if (dateFilter === 'month') {
                        return orderDate.getMonth() === today.getMonth() && 
                               orderDate.getFullYear() === today.getFullYear();
                    } else if (dateFilter === 'year') {
                        return orderDate.getFullYear() === today.getFullYear();
                    }
                    return true;
                });
            }
            
            if (searchQuery) {
                filteredOrders = filteredOrders.filter(order => 
                    order.id.toLowerCase().includes(searchQuery) || 
                    (order.customer_info.firstname + ' ' + order.customer_info.lastname).toLowerCase().includes(searchQuery) ||
                    (order.transaction_code && order.transaction_code.toLowerCase().includes(searchQuery))
                );
            }
            
            // Clear table
            ordersTableContainer.innerHTML = '';
            
            if (filteredOrders.length === 0) {
                showEmptyState(ordersTableContainer, 'No orders found', 'Try adjusting your search or filters');
                return;
            }
            
            // Create table
            const table = document.createElement('table');
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>Order ID</th>
                        <th>Customer</th>
                        <th>Date</th>
                        <th>Amount</th>
                        <th>Payment</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="ordersBody">
                    <!-- Will be populated below -->
                </tbody>
            `;
            
            const ordersBody = table.querySelector('#ordersBody');
            
            // Populate table
            filteredOrders.forEach(order => {
                const row = document.createElement('tr');
                
                // Determine status class
                let statusClass;
                if (order.status === 'completed') {
                    statusClass = 'completed';
                } else if (order.status === 'shipped') {
                    statusClass = 'shipped';
                } else if (order.status === 'pending') {
                    statusClass = 'pending';
                } else if (order.status === 'processing') {
                    statusClass = 'processing';
                } else if (order.status === 'cancelled') {
                    statusClass = 'inactive';
                }
                
                const customerName = `${order.customer_info.firstname} ${order.customer_info.lastname}`;
                const orderDate = new Date(order.order_timestamp);
                
                row.innerHTML = `
                    <td>${order.id}</td>
                    <td>${customerName}</td>
                    <td>${formatDate(orderDate)}</td>
                    <td>$${order.total.toFixed(2)}</td>
                    <td>${capitalizeFirstLetter(order.payment_method)}</td>
                    <td><span class="status ${statusClass}">${capitalizeFirstLetter(order.status)}</span></td>
                    <td>
                        <button class="action-btn view-order" data-id="${order.id}"><i class="fas fa-eye"></i></button>
                        <button class="action-btn print-order" data-id="${order.id}"><i class="fas fa-print"></i></button>
                    </td>
                `;
                
                ordersBody.appendChild(row);
            });
            
            ordersTableContainer.appendChild(table);
            
            // Add event listeners to action buttons
            document.querySelectorAll('.view-order').forEach(button => {
                button.addEventListener('click', function() {
                    const orderId = this.getAttribute('data-id');
                    viewOrder(orderId);
                });
            });
            
            document.querySelectorAll('.print-order').forEach(button => {
                button.addEventListener('click', function() {
                    const orderId = this.getAttribute('data-id');
                    showToast('Print functionality would be implemented here', 'info');
                });
            });
        }

        // Render recent activity
        function renderRecentActivity() {
            recentActivityContainer.innerHTML = '';
            
            if (ordersData.length === 0) {
                showEmptyState(recentActivityContainer, 'No recent activity', 'New orders will appear here');
                return;
            }
            
            // Sort orders by date (newest first)
            const sortedOrders = [...ordersData].sort((a, b) => {
                return new Date(b.order_timestamp) - new Date(a.order_timestamp);
            });
            
            // Get the 5 most recent orders
            const recentOrders = sortedOrders.slice(0, 5);
            
            // Create table
            const table = document.createElement('table');
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Description</th>
                        <th>Time</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Will be populated below -->
                </tbody>
            `;
            
            const tbody = table.querySelector('tbody');
            
            // Populate table
            recentOrders.forEach(order => {
                const row = document.createElement('tr');
                const orderDate = new Date(order.order_timestamp);
                const timeAgo = getTimeAgo(orderDate);
                
                // Determine status class
                let statusClass;
                if (order.status === 'completed') {
                    statusClass = 'completed';
                } else if (order.status === 'shipped') {
                    statusClass = 'shipped';
                } else if (order.status === 'pending') {
                    statusClass = 'pending';
                } else if (order.status === 'processing') {
                    statusClass = 'processing';
                }
                
                row.innerHTML = `
                    <td><i class="fas fa-shopping-cart"></i> Order</td>
                    <td>New order ${order.id} from ${order.customer_info.firstname} ${order.customer_info.lastname}</td>
                    <td>${timeAgo}</td>
                    <td><span class="status ${statusClass}">${capitalizeFirstLetter(order.status)}</span></td>
                `;
                
                tbody.appendChild(row);
            });
            
            recentActivityContainer.appendChild(table);
        }

        // View product details
        function viewProduct(productId) {
            const product = productsData.find(p => p.id === productId);
            if (product) {
                currentProductId = productId;
                
                // Calculate discounted price if applicable
                const discountedPrice = product.discount > 0 
                    ? product.price * (1 - product.discount / 100)
                    : null;
                
                // Create product view HTML
                productViewContainer.innerHTML = `
                    <div class="product-view-images">
                        ${product.images && product.images.length > 0 ? 
                            `<img src="${product.images[0]}" alt="${product.name}" class="product-view-main-image" id="mainProductImage">
                             <div class="product-view-thumbnails">
                                ${product.images.map((img, index) => `
                                    <img src="${img}" alt="Thumbnail ${index + 1}" class="product-view-thumbnail ${index === 0 ? 'active' : ''}" data-index="${index}">
                                `).join('')}
                             </div>` : 
                            `<div style="width: 100%; height: 400px; background-color: #f9f9f9; border-radius: 4px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-image" style="font-size: 3rem; color: #ddd;"></i>
                             </div>`}
                    </div>
                    <div class="product-view-details">
                        <h1 class="product-view-title">${product.name}</h1>
                        ${product.badge ? `<span class="product-view-badge">${capitalizeFirstLetter(product.badge)}</span>` : ''}
                        <div class="product-view-price">
                            ${discountedPrice 
                                ? `<span class="product-view-original-price">$${product.price.toFixed(2)}</span>
                                   <span class="product-view-discount">(${product.discount}% OFF)</span><br>
                                   <span>$${discountedPrice.toFixed(2)}</span>`
                                : `$${product.price.toFixed(2)}`}
                        </div>
                        <div class="product-view-meta">
                            <p><strong>Category:</strong> ${product.category} > ${product.subcategory} > ${product.class}</p>
                            <p><strong>Brand:</strong> ${product.brand}</p>
                            <p><strong>Status:</strong> <span class="status ${product.status === 'active' ? 'completed' : 'inactive'}">${capitalizeFirstLetter(product.status)}</span></p>
                            <p><strong>Stock:</strong> ${product.stock} units</p>
                        </div>
                        ${product.variants && product.variants.length > 0 ? `
                            <div class="product-view-meta">
                                <p><strong>Variants:</strong></p>
                                ${product.variants.map(variant => `
                                    <p>${variant.color}: ${variant.sizes.join(', ')}</p>
                                `).join('')}
                            </div>
                        ` : ''}
                        ${product.features && product.features.length > 0 ? `
                            <div class="product-view-features">
                                <h4>Features</h4>
                                <ul>
                                    ${product.features.map(feature => `<li>${feature}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                        ${product.description ? `
                            <div class="product-view-description">
                                <h4>Description</h4>
                                <p>${product.description}</p>
                            </div>
                        ` : ''}
                    </div>
                `;
                
                // Add event listeners to thumbnails if they exist
                if (product.images && product.images.length > 0) {
                    document.querySelectorAll('.product-view-thumbnail').forEach(thumb => {
                        thumb.addEventListener('click', function() {
                            const index = this.getAttribute('data-index');
                            document.querySelector('.product-view-main-image').src = product.images[index];
                            document.querySelectorAll('.product-view-thumbnail').forEach(t => t.classList.remove('active'));
                            this.classList.add('active');
                        });
                    });
                }
                
                   showModal(productViewModal);
            }
        }

        // Edit product
        function editProduct(productId) {
            const product = productsData.find(p => p.id === productId);
            if (product) {
                currentProductId = productId;
                
                // Reset the edit form
                resetEditProductForm();
                
                // Populate form with product data
                document.getElementById('editProductId').value = product.id;
                document.getElementById('editProductCategory').value = product.category;
                
                // Trigger change event to populate subcategories
                const event = new Event('change');
                document.getElementById('editProductCategory').dispatchEvent(event);
                
                // Set subcategory after a small delay to allow options to populate
                setTimeout(() => {
                    document.getElementById('editProductSubcategory').value = product.subcategory;
                    const subcategoryEvent = new Event('change');
                    document.getElementById('editProductSubcategory').dispatchEvent(subcategoryEvent);
                    
                    setTimeout(() => {
                        document.getElementById('editProductClass').value = product.class;
                        const classEvent = new Event('change');
                        document.getElementById('editProductClass').dispatchEvent(classEvent);
                        
                        setTimeout(() => {
                            document.getElementById('editProductBrand').value = product.brand;
                            if (product.brand === 'other') {
                                document.getElementById('editOtherBrandInput').style.display = 'block';
                                document.getElementById('editOtherBrandInput').value = product.brand;
                            }
                        }, 50);
                    }, 50);
                }, 50);
                
                document.getElementById('editProductName').value = product.name;
                document.getElementById('editProductPrice').value = product.price;
                document.getElementById('editProductDiscount').value = product.discount || 0;
                document.getElementById('editProductStock').value = product.stock;
                document.getElementById('editProductStatus').value = product.status;
                document.getElementById('editProductBadge').value = product.badge || '';
                document.getElementById('editProductDescription').value = product.description || '';
                
                // Populate features
                const editFeaturesList = document.getElementById('editFeaturesList');
                editFeaturesList.innerHTML = '';
                if (product.features && product.features.length > 0) {
                    product.features.forEach(feature => {
                        const featureTag = document.createElement('div');
                        featureTag.className = 'feature-tag';
                        featureTag.innerHTML = `
                            ${feature}
                            <span class="remove-feature">&times;</span>
                        `;
                        editFeaturesList.appendChild(featureTag);
                        
                        // Add event listener to remove button
                        featureTag.querySelector('.remove-feature').addEventListener('click', function() {
                            featureTag.remove();
                        });
                    });
                }
                
                // Populate variants
                if (product.variants && product.variants.length > 0) {
                    document.getElementById('editHasVariantsToggle').checked = true;
                    document.getElementById('editVariantsContainer').style.display = 'block';
                    const editColorVariantsContainer = document.getElementById('editColorVariantsContainer');
                    editColorVariantsContainer.innerHTML = '';
                    
                    product.variants.forEach(variant => {
                        const colorVariant = document.createElement('div');
                        colorVariant.className = 'color-variant';
                        colorVariant.innerHTML = `
                            <div class="color-variant-header">
                                <span class="color-variant-name">${variant.color}</span>
                                <button class="action-btn remove-color-variant" data-color="${variant.color}"><i class="fas fa-trash"></i></button>
                            </div>
                            <div class="color-variant-sizes" id="edit-sizes-${variant.color.replace(/\s+/g, '-')}">
                                <!-- Sizes will be added below -->
                            </div>
                            <div class="add-size-container">
                                <input type="text" class="size-input" placeholder="Add size (e.g. M)" data-color="${variant.color}">
                                <button class="btn btn-secondary add-size-btn" data-color="${variant.color}">Add Size</button>
                            </div>
                        `;
                        
                        editColorVariantsContainer.appendChild(colorVariant);
                        
                        // Populate sizes
                        const sizesContainer = colorVariant.querySelector(`#edit-sizes-${variant.color.replace(/\s+/g, '-')}`);
                        variant.sizes.forEach(size => {
                            const sizeTag = document.createElement('div');
                            sizeTag.className = 'size-tag';
                            sizeTag.innerHTML = `
                                ${size}
                                <span class="remove-size" data-color="${variant.color}" data-size="${size}">&times;</span>
                            `;
                            sizesContainer.appendChild(sizeTag);
                        });
                        
                        // Add event listeners for this color variant
                        colorVariant.querySelector('.remove-color-variant').addEventListener('click', function() {
                            colorVariant.remove();
                        });
                        
                        colorVariant.querySelector('.add-size-btn').addEventListener('click', function() {
                            const color = this.getAttribute('data-color');
                            const sizeInput = colorVariant.querySelector(`.size-input[data-color="${color}"]`);
                            addSizeToVariant(color, sizeInput.value, 'edit');
                            sizeInput.value = '';
                        });
                        
                        colorVariant.querySelector('.size-input').addEventListener('keypress', function(e) {
                            if (e.key === 'Enter') {
                                const color = this.getAttribute('data-color');
                                addSizeToVariant(color, this.value, 'edit');
                                this.value = '';
                            }
                        });
                        
                        // Add event listeners to remove size buttons
                        sizesContainer.querySelectorAll('.remove-size').forEach(button => {
                            button.addEventListener('click', function() {
                                const sizeTag = this.closest('.size-tag');
                                sizeTag.remove();
                            });
                        });
                    });
                } else {
                    document.getElementById('editHasVariantsToggle').checked = false;
                    document.getElementById('editVariantsContainer').style.display = 'none';
                }
                
                // Populate images
                const editImagesPreviewContainer = document.getElementById('editImagesPreviewContainer');
                editImagesPreviewContainer.innerHTML = '';
                if (product.images && product.images.length > 0) {
                    product.images.forEach((img, index) => {
                        const imgPreview = document.createElement('div');
                        imgPreview.className = 'media-preview';
                        imgPreview.innerHTML = `
                            <img src="${img}" alt="Product Image ${index + 1}">
                            <button class="remove-media" data-url="${img}">&times;</button>
                        `;
                        editImagesPreviewContainer.appendChild(imgPreview);
                        
                        // Add event listener to remove button
                        imgPreview.querySelector('.remove-media').addEventListener('click', function() {
                            const deletedImagesInput = document.getElementById('deletedImages');
                            const deletedImages = deletedImagesInput.value ? JSON.parse(deletedImagesInput.value) : [];
                            deletedImages.push(this.getAttribute('data-url'));
                            deletedImagesInput.value = JSON.stringify(deletedImages);
                            imgPreview.remove();
                        });
                    });
                }
                
                // Populate video if exists
                const editVideoPreviewContainer = document.getElementById('editVideoPreviewContainer');
                editVideoPreviewContainer.innerHTML = '';
                if (product.video) {
                    const videoPreview = document.createElement('div');
                    videoPreview.className = 'media-preview';
                    videoPreview.innerHTML = `
                        <video controls>
                            <source src="${product.video}" type="video/mp4">
                        </video>
                        <button class="remove-media" data-url="${product.video}" data-type="video">&times;</button>
                    `;
                    editVideoPreviewContainer.appendChild(videoPreview);
                    
                    // Add event listener to remove button
                    videoPreview.querySelector('.remove-media').addEventListener('click', function() {
                        document.getElementById('deletedVideo').value = this.getAttribute('data-url');
                        videoPreview.remove();
                    });
                }
                
                showModal(editProductModal);
            }
        }

        // Reset add product form
        function resetAddProductForm() {
            document.getElementById('addProductForm').reset();
            document.getElementById('addFeaturesList').innerHTML = '';
            document.getElementById('addColorVariantsContainer').innerHTML = '';
            document.getElementById('addImagesPreviewContainer').innerHTML = '';
            document.getElementById('addVideoPreviewContainer').innerHTML = '';
            document.getElementById('addVariantsContainer').style.display = 'none';
            document.getElementById('addHasVariantsToggle').checked = false;
            document.getElementById('addProductSubcategory').innerHTML = '<option value="">Select Subcategory</option>';
            document.getElementById('addProductClass').innerHTML = '<option value="">Select Class</option>';
            document.getElementById('addProductBrand').innerHTML = '<option value="">Select Brand</option>';
            document.getElementById('addOtherBrandInput').style.display = 'none';
            document.getElementById('addProductSubcategory').disabled = true;
            document.getElementById('addProductClass').disabled = true;
            document.getElementById('addProductBrand').disabled = true;
        }

        // Reset edit product form
        function resetEditProductForm() {
            document.getElementById('editProductForm').reset();
            document.getElementById('editFeaturesList').innerHTML = '';
            document.getElementById('editColorVariantsContainer').innerHTML = '';
            document.getElementById('editImagesPreviewContainer').innerHTML = '';
            document.getElementById('editVideoPreviewContainer').innerHTML = '';
            document.getElementById('editVariantsContainer').style.display = 'none';
            document.getElementById('editHasVariantsToggle').checked = false;
            document.getElementById('editProductSubcategory').innerHTML = '<option value="">Select Subcategory</option>';
            document.getElementById('editProductClass').innerHTML = '<option value="">Select Class</option>';
            document.getElementById('editProductBrand').innerHTML = '<option value="">Select Brand</option>';
            document.getElementById('editOtherBrandInput').style.display = 'none';
            document.getElementById('editProductSubcategory').disabled = true;
            document.getElementById('editProductClass').disabled = true;
            document.getElementById('editProductBrand').disabled = true;
            document.getElementById('deletedImages').value = '';
            document.getElementById('deletedVideo').value = '';
        }

        /*/ Add feature to product form
        function addFeature(formType) {
            const featureInput = document.getElementById(`${formType}FeatureInput`);
            const featuresList = document.getElementById(`${formType}FeaturesList`);
            
            if (featureInput.value.trim() === '') {
                showToast('Please enter a feature', 'error');
                return;
            }
            
            const featureTag = document.createElement('div');
            featureTag.className = 'feature-tag';
            featureTag.innerHTML = `
                ${featureInput.value.trim()}
                <span class="remove-feature">&times;</span>
            `;
            featuresList.appendChild(featureTag);
            
            // Add event listener to remove button
            featureTag.querySelector('.remove-feature').addEventListener('click', function() {
                featureTag.remove();
            });
            
            featureInput.value = '';
        }

        // Add color variant to product form
        function addColorVariant(formType) {
            const colorNameInput = document.getElementById(`${formType}ColorNameInput`);
            const colorVariantsContainer = document.getElementById(`${formType}ColorVariantsContainer`);
            
            if (colorNameInput.value.trim() === '') {
                showToast('Please enter a color name', 'error');
                return;
            }
            
            const colorName = colorNameInput.value.trim();
            
            // Check if color already exists
            const existingColor = Array.from(colorVariantsContainer.querySelectorAll('.color-variant-name'))
                .find(el => el.textContent.toLowerCase() === colorName.toLowerCase());
            
            if (existingColor) {
                showToast('This color variant already exists', 'error');
                return;
            }
            
            const colorVariant = document.createElement('div');
            colorVariant.className = 'color-variant';
            colorVariant.innerHTML = `
                <div class="color-variant-header">
                    <span class="color-variant-name">${colorName}</span>
                    <button class="action-btn remove-color-variant" data-color="${colorName}"><i class="fas fa-trash"></i></button>
                </div>
                <div class="color-variant-sizes" id="${formType}-sizes-${colorName.replace(/\s+/g, '-')}">
                    <!-- Sizes will be added here -->
                </div>
                <div class="add-size-container">
                    <input type="text" class="size-input" placeholder="Add size (e.g. M)" data-color="${colorName}">
                    <button class="btn btn-secondary add-size-btn" data-color="${colorName}">Add Size</button>
                </div>
            `;
            
            colorVariantsContainer.appendChild(colorVariant);
            
            // Add event listeners for this color variant
            colorVariant.querySelector('.remove-color-variant').addEventListener('click', function() {
                colorVariant.remove();
            });
            
            colorVariant.querySelector('.add-size-btn').addEventListener('click', function() {
                const color = this.getAttribute('data-color');
                const sizeInput = colorVariant.querySelector(`.size-input[data-color="${color}"]`);
                addSizeToVariant(color, sizeInput.value, formType);
                sizeInput.value = '';
            });
            
            colorVariant.querySelector('.size-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const color = this.getAttribute('data-color');
                    addSizeToVariant(color, this.value, formType);
                    this.value = '';
                }
            });
            
            colorNameInput.value = '';
        }

        // Add size to color variant
        function addSizeToVariant(color, size, formType) {
            if (size.trim() === '') {
                showToast('Please enter a size', 'error');
                return;
            }
            
            const sizesContainer = document.getElementById(`${formType}-sizes-${color.replace(/\s+/g, '-')}`);
            
            // Check if size already exists for this color
            const existingSize = Array.from(sizesContainer.querySelectorAll('.size-tag'))
                .find(el => el.textContent.replace('×', '').trim().toLowerCase() === size.trim().toLowerCase());
            
            if (existingSize) {
                showToast('This size already exists for this color', 'error');
                return;
            }
            
            const sizeTag = document.createElement('div');
            sizeTag.className = 'size-tag';
            sizeTag.innerHTML = `
                ${size.trim()}
                <span class="remove-size" data-color="${color}" data-size="${size.trim()}">&times;</span>
            `;
            sizesContainer.appendChild(sizeTag);
            
            // Add event listener to remove button
            sizeTag.querySelector('.remove-size').addEventListener('click', function() {
                sizeTag.remove();
            });
        }

        // Handle image upload
        function handleImageUpload(files, formType) {
            const previewContainer = document.getElementById(`${formType}ImagesPreviewContainer`);
            const maxImages = 7;
            
            // Calculate remaining slots for new images
            const existingImages = previewContainer.querySelectorAll('.media-preview').length;
            const remainingSlots = maxImages - existingImages;
            
            if (files.length > remainingSlots) {
                showToast(`You can only upload up to ${remainingSlots} more images (max ${maxImages} total)`, 'warning');
                return;
            }
            
            Array.from(files).slice(0, remainingSlots).forEach(file => {
                if (!file.type.match('image.*')) {
                    showToast('Only image files are allowed', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imgPreview = document.createElement('div');
                    imgPreview.className = 'media-preview';
                    imgPreview.innerHTML = `
                        <img src="${e.target.result}" alt="Uploaded Image">
                        <button class="remove-media">&times;</button>
                    `;
                    previewContainer.appendChild(imgPreview);
                    
                    // Add event listener to remove button
                    imgPreview.querySelector('.remove-media').addEventListener('click', function() {
                        imgPreview.remove();
                    });
                };
                reader.readAsDataURL(file);
            });
        }

        // Handle video upload
        function handleVideoUpload(file, formType) {
            const previewContainer = document.getElementById(`${formType}VideoPreviewContainer`);
            
            if (!file.type.match('video.*')) {
                showToast('Only video files are allowed', 'error');
                return;
            }
            
            // Clear previous video if any
            previewContainer.innerHTML = '';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const videoPreview = document.createElement('div');
                videoPreview.className = 'media-preview';
                videoPreview.innerHTML = `
                    <video controls>
                        <source src="${e.target.result}" type="${file.type}">
                    </video>
                    <button class="remove-media">&times;</button>
                `;
                previewContainer.appendChild(videoPreview);
                
                // Add event listener to remove button
                videoPreview.querySelector('.remove-media').addEventListener('click', function() {
                    videoPreview.remove();
                });
            };
            reader.readAsDataURL(file);
        }

        // Save product (both add and edit)
        function saveProduct(formType) {
            const isEdit = formType === 'edit';
            const formPrefix = isEdit ? 'edit' : 'add';
            const saveBtn = document.getElementById(isEdit ? 'saveEditedProductBtn' : 'saveNewProductBtn');
            
            // Show loading state on save button
            saveBtn.classList.add('loading');
            saveBtn.disabled = true;
            
            // Get form values
            const category = document.getElementById(`${formPrefix}ProductCategory`).value;
            const subcategory = document.getElementById(`${formPrefix}ProductSubcategory`).value;
            const productClass = document.getElementById(`${formPrefix}ProductClass`).value;
            let brand = document.getElementById(`${formPrefix}ProductBrand`).value;
            
            // If brand is "other", use the input value
            if (brand === 'other') {
                brand = document.getElementById(`${formPrefix}OtherBrandInput`).value;
            }
            
            const name = document.getElementById(`${formPrefix}ProductName`).value;
            const price = parseFloat(document.getElementById(`${formPrefix}ProductPrice`).value);
            const discount = parseInt(document.getElementById(`${formPrefix}ProductDiscount`).value) || 0;
            const stock = parseInt(document.getElementById(`${formPrefix}ProductStock`).value);
            const status = document.getElementById(`${formPrefix}ProductStatus`).value;
            const badge = document.getElementById(`${formPrefix}ProductBadge`).value || null;
            const description = document.getElementById(`${formPrefix}ProductDescription`).value;
            
            // Get features from the list
            const features = [];
            document.querySelectorAll(`#${formPrefix}FeaturesList .feature-tag`).forEach(tag => {
                features.push(tag.textContent.replace('×', '').trim());
            });
            
            // Get variants if enabled
            let variants = [];
            if (document.getElementById(`${formPrefix}HasVariantsToggle`).checked) {
                document.querySelectorAll(`#${formPrefix}ColorVariantsContainer .color-variant`).forEach(variant => {
                    const color = variant.querySelector('.color-variant-name').textContent;
                    const sizes = [];
                    
                    variant.querySelectorAll('.size-tag').forEach(sizeTag => {
                        sizes.push(sizeTag.textContent.replace('×', '').trim());
                    });
                    
                    if (color && sizes.length > 0) {
                        variants.push({
                            color: color,
                            sizes: sizes
                        });
                    }
                });
            }
            
            // Get images (in a real app, you would upload these to a server)
            const images = [];
            document.querySelectorAll(`#${formPrefix}ImagesPreviewContainer .media-preview img`).forEach(img => {
                images.push(img.src);
            });
            
            // Get video (in a real app, you would upload this to a server)
            let video = null;
            const videoPreview = document.querySelector(`#${formPrefix}VideoPreviewContainer video`);
            if (videoPreview) {
                video = videoPreview.querySelector('source').src;
            }
            
            // Get deleted media for edit form
            let deletedImages = [];
            let deletedVideo = null;
            if (isEdit) {
                const deletedImagesInput = document.getElementById('deletedImages').value;
                deletedImages = deletedImagesInput ? JSON.parse(deletedImagesInput) : [];
                deletedVideo = document.getElementById('deletedVideo').value || null;
            }
            
            // Validate required fields
            if (!category || !subcategory || !productClass || !brand || !name || isNaN(price) || isNaN(stock)) {
                showToast('Please fill in all required fields', 'error');
                saveBtn.classList.remove('loading');
                saveBtn.disabled = false;
                return;
            }
            
            // Create product data object
            const productData = {
                category: category,
                subcategory: subcategory,
                class: productClass,
                brand: brand,
                name: name,
                price: price,
                discount: discount,
                stock: stock,
                status: status,
                badge: badge,
                features: features,
                description: description,
                variants: variants,
                images: images,
                video: video,
                deletedImages: deletedImages,
                deletedVideo: deletedVideo
            };
            
            // Determine endpoint and method
            const endpoint = isEdit ? `/crud/update-product/${document.getElementById('editProductId').value}` : '/crud/create-product';
            const method = isEdit ? 'PUT' : 'POST';
            
            // Send request to server
            fetch(endpoint, {
                method: method,
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(productData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                if (isEdit) {
                    showToast('Product updated successfully', 'success');
                    
                    // Update the product in our local data
                    const productIndex = productsData.findIndex(p => p.id === currentProductId);
                    if (productIndex !== -1) {
                        productsData[productIndex] = {
                            ...productsData[productIndex],
                            ...productData,
                            id: currentProductId
                        };
                    }
                } else {
                    showToast('Product added successfully', 'success');
                    
                    // Add the new product to our local data
                    productsData.unshift({
                        ...productData,
                        id: data.id // Assuming server returns the new product ID
                    });
                }
                
                // Refresh products table and close modal
                renderProductsTable();
                hideModal(isEdit ? editProductModal : addProductModal);
            })
            .catch(error => {
                console.error('Error saving product:', error);
                showToast('Failed to save product. Please try again.', 'error');
            })
            .finally(() => {
                saveBtn.classList.remove('loading');
                saveBtn.disabled = false;
            });
        } */
// Update features input in add product modal
            function updateFeaturesInput() {
                const featuresList = document.getElementById('addFeaturesList');
                const features = [];

                featuresList.querySelectorAll('.feature-tag').forEach(tag => {
                    features.push(tag.textContent.replace('×', '').trim());
                });

                document.getElementById('addProductFeatures').value = JSON.stringify(features);
            }



         // Add feature to product form
        function addFeature() {
            const featureInput = document.getElementById(`addFeatureInput`);
            const featuresList = document.getElementById(`addFeaturesList`);
            
            if (featureInput.value.trim() === '') {
                showToast('Please enter a feature', 'error');
                return;
            }
            
            const featureTag = document.createElement('div');
            featureTag.className = 'feature-tag';
            featureTag.innerHTML = `
                ${featureInput.value.trim()}
                <span class="remove-feature">&times;</span>
            `;
            featuresList.appendChild(featureTag);
            
            // Add event listener to remove button
            featureTag.querySelector('.remove-feature').addEventListener('click', function() {
                featureTag.remove();
            });
            
            featureInput.value = '';
        }

        // Add color variant to product form
        function addColorVariant(formType) {
            const colorNameInput = document.getElementById(`${formType}ColorNameInput`);
            const colorVariantsContainer = document.getElementById(`${formType}ColorVariantsContainer`);
            
            if (colorNameInput.value.trim() === '') {
                showToast('Please enter a color name', 'error');
                return;
            }
            
            const colorName = colorNameInput.value.trim();
            
            // Check if color already exists
            const existingColor = Array.from(colorVariantsContainer.querySelectorAll('.color-variant-name'))
                .find(el => el.textContent.toLowerCase() === colorName.toLowerCase());
            
            if (existingColor) {
                showToast('This color variant already exists', 'error');
                return;
            }
            
            const colorVariant = document.createElement('div');
            colorVariant.className = 'color-variant';
            colorVariant.innerHTML = `
                <div class="color-variant-header">
                    <span class="color-variant-name">${colorName}</span>
                    <button class="action-btn remove-color-variant" data-color="${colorName}"><i class="fas fa-trash"></i></button>
                </div>
                <div class="color-variant-sizes" id="${formType}-sizes-${colorName.replace(/\s+/g, '-')}">
                    <!-- Sizes will be added here -->
                </div>
                <div class="add-size-container">
                    <input type="text" class="size-input" placeholder="Add size (e.g. M)" data-color="${colorName}">
                    <button type="button" class="btn btn-secondary add-size-btn" data-color="${colorName}">Add Size</button>
                </div>
            `;
            
            colorVariantsContainer.appendChild(colorVariant);
            
            // Add event listeners for this color variant
            colorVariant.querySelector('.remove-color-variant').addEventListener('click', function() {
                colorVariant.remove();
            });
            
            colorVariant.querySelector('.add-size-btn').addEventListener('click', function() {
                const color = this.getAttribute('data-color');
                const sizeInput = colorVariant.querySelector(`.size-input[data-color="${color}"]`);
                addSizeToVariant(color, sizeInput.value, formType);
                sizeInput.value = '';
            });
            
            colorVariant.querySelector('.size-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const color = this.getAttribute('data-color');
                    addSizeToVariant(color, this.value, formType);
                    this.value = '';
                }
            });
            
            colorNameInput.value = '';
        }

        // Add size to color variant
        function addSizeToVariant(color, size, formType) {
            if (size.trim() === '') {
                showToast('Please enter a size', 'error');
                return;
            }
            
            const sizesContainer = document.getElementById(`${formType}-sizes-${color.replace(/\s+/g, '-')}`);
            
            // Check if size already exists for this color
            const existingSize = Array.from(sizesContainer.querySelectorAll('.size-tag'))
                .find(el => el.textContent.replace('×', '').trim().toLowerCase() === size.trim().toLowerCase());
            
            if (existingSize) {
                showToast('This size already exists for this color', 'error');
                return;
            }
            
            const sizeTag = document.createElement('div');
            sizeTag.className = 'size-tag';
            sizeTag.innerHTML = `
                ${size.trim()}
                <span class="remove-size" data-color="${color}" data-size="${size.trim()}">&times;</span>
            `;
            sizesContainer.appendChild(sizeTag);
            
            // Add event listener to remove button
            sizeTag.querySelector('.remove-size').addEventListener('click', function() {
                sizeTag.remove();
            });
        }

        // Handle image upload
        function handleImageUpload(files, formType) {
            const previewContainer = document.getElementById(`${formType}ImagesPreviewContainer`);
            const maxImages = 7;
            
            // Calculate remaining slots for new images
            const existingImages = previewContainer.querySelectorAll('.media-preview').length;
            const remainingSlots = maxImages - existingImages;
            
            if (files.length > remainingSlots) {
                showToast(`You can only upload up to ${remainingSlots} more images (max ${maxImages} total)`, 'warning');
                return;
            }
            
            Array.from(files).slice(0, remainingSlots).forEach(file => {
                if (!file.type.match('image.*')) {
                    showToast('Only image files are allowed', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imgPreview = document.createElement('div');
                    imgPreview.className = 'media-preview';
                    imgPreview.innerHTML = `
                        <img src="${e.target.result}" alt="Uploaded Image">
                        <button class="remove-media">&times;</button>
                    `;
                    previewContainer.appendChild(imgPreview);
                    
                    // Add event listener to remove button
                    imgPreview.querySelector('.remove-media').addEventListener('click', function() {
                        imgPreview.remove();
                    });
                };
                reader.readAsDataURL(file);
            });
        }

        // Handle video upload
        function handleVideoUpload(file, formType) {
            const previewContainer = document.getElementById(`${formType}VideoPreviewContainer`);
            
            if (!file.type.match('video.*')) {
                showToast('Only video files are allowed', 'error');
                return;
            }
            
            // Clear previous video if any
            previewContainer.innerHTML = '';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const videoPreview = document.createElement('div');
                videoPreview.className = 'media-preview';
                videoPreview.innerHTML = `
                    <video controls>
                        <source src="${e.target.result}" type="${file.type}">
                    </video>
                    <button class="remove-media">&times;</button>
                `;
                previewContainer.appendChild(videoPreview);
                
                // Add event listener to remove button
                videoPreview.querySelector('.remove-media').addEventListener('click', function() {
                    videoPreview.remove();
                });
            };
           
            reader.readAsDataURL(file);
        }

        ///////////////////////////////////////////////

        // Function to handle product submission to backend
            async function postProductToServer(productData) {
                try {
                    let brand = productData.brand;
                    if (productData.otherBrand) {
                        brand = productData.otherBrand;
                    }
                    // Create FormData object to handle file uploads
                    const formData = new FormData();

                    // Add all product data to FormData
                    formData.append('category', productData.category);
                    formData.append('subcategory', productData.subcategory);
                    formData.append('productClass', productData.productClass);
                    formData.append('brand', productData.brand);
                    formData.append('name', productData.name);
                    formData.append('price', productData.price);
                    formData.append('discount', productData.discount);
                    formData.append('stock', productData.stock);
                    formData.append('status', productData.status);
                    formData.append('badge', productData.badge);
                    formData.append('features', JSON.stringify(productData.features));
                    formData.append('description', productData.description);
                    formData.append('variants', JSON.stringify(productData.variants));

                    // Add image files
                    const imagesInput = document.getElementById('addProductImages');
                    for (let i = 0; i < imagesInput.files.length; i++) {
                        formData.append('productImages', imagesInput.files[i]);
                    }

                    // Add video file if exists
                    const videoInput = document.getElementById('addProductVideo');
                    if (videoInput.files.length > 0) {
                        formData.append('productVideo', videoInput.files[0]);
                    }

                    // Send to backend
                    const response = await fetch('/crud/add-product', {
                        method: 'POST',
                        body: formData
                        // Headers are automatically set by browser for FormData
                    });

                    if (!response.ok) {
                        throw new Error('Server responded with error');
                    }

                    return await response.json();
                } catch (error) {
                    console.error('Error posting product:', error);
                    throw error; // Re-throw to be handled by caller
                }
            }

            // Modified addProduct function that uses the backend
            async function addProduct() {

            const saveBtn = document.getElementById('saveNewProductBtn');
            saveBtn.classList.add('loading');
            saveBtn.disabled = true;

            const category = document.getElementById(`addProductCategory`).value;
            const subcategory = document.getElementById(`addProductSubcategory`).value;
            const productClass = document.getElementById(`addProductClass`).value;
            let brand = document.getElementById(`addProductBrand`).value; 
            if (brand === 'other') {
                brand = document.getElementById(`addOtherBrandInput`).value;
            }    
            const name = document.getElementById(`addProductName`).value;
            const price = parseFloat(document.getElementById(`addProductPrice`).value);
            const discount = parseInt(document.getElementById(`addProductDiscount`).value) || 0;
            const stock = parseInt(document.getElementById(`addProductStock`).value);
            const status = document.getElementById(`addProductStatus`).value;
            const badge = document.getElementById(`addProductBadge`).value || null;
            const description = document.getElementById(`addProductDescription`).value;
            //const features = JSON.parse(document.getElementById('productFeatures').value || '[]');
            const features = [];
            document.querySelectorAll(`#addFeaturesList .feature-tag`).forEach(tag => {
                features.push(tag.textContent.replace('×', '').trim());
            });
            // Get variants if enabled
            let variants = [];
            if (document.getElementById(`addHasVariantsToggle`).checked) {
                document.querySelectorAll(`#addColorVariantsContainer .color-variant`).forEach(variant => {
                    const color = variant.querySelector('.color-variant-name').textContent;
                    const sizes = [];
                    
                    variant.querySelectorAll('.size-tag').forEach(sizeTag => {
                        sizes.push(sizeTag.textContent.replace('×', '').trim());
                    });
                    
                    if (color && sizes.length > 0) {
                        variants.push({
                            color: color,
                            sizes: sizes
                        });
                    }
                });
            }
            
            // Get images (in a real app, you would upload these to a server)
            const images = [];
            document.querySelectorAll(`#addImagesPreviewContainer .media-preview img`).forEach(img => {
                images.push(img.src);
            });
            
            // Get video (in a real app, you would upload this to a server)
            let video = null;
            const videoPreview = document.querySelector(`#addVideoPreviewContainer video`);
            if (videoPreview) {
                video = videoPreview.querySelector('source').src;
            }
           
            // Validate required fields
            if (!category || !subcategory || !productClass || !brand || !name || isNaN(price) || isNaN(stock)) {
                showToast('Please fill in all required fields', 'error');
                saveBtn.classList.remove('loading');
                saveBtn.disabled = false;
                return;
            }
                    

                // Prepare product data object
                const productData = {
                 category, 
                 subcategory,
                 productClass,
                 brand,
                 name,
                 price, 
                 discount,
                 stock,
                 status,
                 badge,
                 features,
                 description, 
                 variants 
                };

                // Check for images (original validation)
                const imagesInput = document.getElementById('addProductImages');
                if (imagesInput.files.length === 0) {
                    alert('At least one product image is required');
                    return;
                }

                try {
                    // Post to server instead of local array
                    const result = await postProductToServer(productData);

                    // On success, add to local array (matching original behavior)
                    productsData.push(result.product);

                    // Update vendor's product count (original code)

                    // Refresh products table (original code)
                    renderProductsTable();

                    // Close modal (original code)
                    renderProductsTable();
                    hideModal(addProductModal);

                    // Show success message (original code)
                    showToast('Product added successfully!', 'success');
                } catch (error) {
                      console.error('Error saving product:', error);
                      showToast('Failed to save product. Please try again.', 'error');
                } finally {
                    saveBtn.classList.remove('loading');
                    saveBtn.disabled = false;
                }
            }


        // Delete product
        function deleteProduct(productId) {
            if (!confirm('Are you sure you want to delete this product? This action cannot be undone.')) {
                return;
            }
            
            const deleteBtn = document.querySelector(`.delete-product[data-id="${productId}"]`);
            if (deleteBtn) {
                deleteBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                deleteBtn.disabled = true;
            }

            fetch(`/crud/delete-product/${productId}`, {
                method: 'DELETE'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                showToast('Product deleted successfully', 'success');
                
                // Remove the product from our local data
                productsData = productsData.filter(p => p.id !== productId);
                
                // Refresh products table
                renderProductsTable();
            })
            .catch(error => {
                console.error('Error deleting product:', error);
                showToast('Failed to delete product. Please try again.', 'error');
            })
            .finally(() => {
                if (deleteBtn) {
                    deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                    deleteBtn.disabled = false;
                }
            });
        }

        // View order details
        function viewOrder(orderId) {
            const order = ordersData.find(o => o.id === orderId);
            if (order) {
                currentOrderId = orderId;
                
                // Update order progress based on status
                updateOrderProgress(order.status);
                
                // Update order information
                document.getElementById('modalOrderId').textContent = order.id;
                document.getElementById('modalOrderDate').textContent = formatDate(new Date(order.order_timestamp));
                document.getElementById('modalOrderStatus').textContent = capitalizeFirstLetter(order.status);
                document.getElementById('modalOrderStatus').className = `status ${order.status}`;
                document.getElementById('modalPaymentMethod').textContent = capitalizeFirstLetter(order.payment_method);
                document.getElementById('modalTransactionId').textContent = order.transaction_code || 'N/A';
                
                // Update customer information
                document.getElementById('modalCustomerName').textContent = 
                    `${order.customer_info.firstname} ${order.customer_info.lastname}`;
                document.getElementById('modalCustomerEmail').textContent = order.customer_info.email;
                document.getElementById('modalCustomerPhone').textContent = order.customer_info.telephone;
                
                // Update shipping address
                let shippingAddress = '';
                if (order.customer_info.delivery_method === 'store') {
                    shippingAddress = 'Store Pickup';
                } else {
                    const address = order.customer_info.delivery_address;
                    shippingAddress = `${address.address_line1 || ''}, ${address.city || ''}, ${address.state || ''}, ${address.country || ''}, ${address.postal_code || ''}`;
                }
                document.getElementById('modalShippingAddress').textContent = shippingAddress;
                
                // Update order items
                modalOrderItems.innerHTML = '';
                order.items.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.name}</td>
                        <td>$${item.price.toFixed(2)}</td>
                        <td>${item.quantity}</td>
                        <td>$${(item.price * item.quantity).toFixed(2)}</td>
                    `;
                    modalOrderItems.appendChild(row);
                });
                
                // Update totals
                document.getElementById('modalSubtotal').textContent = `$${order.subtotal.toFixed(2)}`;
                document.getElementById('modalShipping').textContent = `$${order.delivery_fee.toFixed(2)}`;
                document.getElementById('modalTax').textContent = `$${(order.total - order.subtotal - order.delivery_fee).toFixed(2)}`;
                document.getElementById('modalTotal').textContent = `$${order.total.toFixed(2)}`;
                
                // Update notes if any
                document.getElementById('orderNotes').value = order.notes || '';
                
                showModal(orderModal);
            }
        }

        // Update order status
        function updateOrderStatus(orderId) {
            const order = ordersData.find(o => o.id === orderId);
            if (!order) return;
            
            // Determine next status
            let newStatus;
            if (order.status === 'pending') {
                newStatus = 'processing';
            } else if (order.status === 'processing') {
                newStatus = 'shipped';
            } else if (order.status === 'shipped') {
                newStatus = 'completed';
            } else {
                return; // No further status progression
            }
            
            // Show loading state on update button
            const updateBtn = document.getElementById('updateOrderBtn');
            updateBtn.classList.add('loading');
            updateBtn.disabled = true;
            
            // Send request to server
            fetch(`/crud/update-order/${orderId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    status: newStatus,
                    notes: document.getElementById('orderNotes').value
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                showToast('Order status updated successfully', 'success');
                
                // Update the order in our local data
                const orderIndex = ordersData.findIndex(o => o.id === orderId);
                if (orderIndex !== -1) {
                    ordersData[orderIndex].status = newStatus;
                    ordersData[orderIndex].notes = document.getElementById('orderNotes').value;
                }
                
                // Update the UI
                updateOrderProgress(newStatus);
                document.getElementById('modalOrderStatus').textContent = capitalizeFirstLetter(newStatus);
                document.getElementById('modalOrderStatus').className = `status ${newStatus}`;
                
                // Refresh orders table and recent activity
                renderOrdersTable();
                renderRecentActivity();
            })
            .catch(error => {
                console.error('Error updating order:', error);
                showToast('Failed to update order status. Please try again.', 'error');
            })
            .finally(() => {
                updateBtn.classList.remove('loading');
                updateBtn.disabled = false;
            });
        }

        // Update order progress visualization
        function updateOrderProgress(status) {
            const steps = document.querySelectorAll('.order-progress .progress-step');
            
            steps.forEach(step => {
                step.classList.remove('active', 'completed');
            });
            
            if (status === 'pending') {
                steps[0].classList.add('completed');
                steps[1].classList.add('active');
            } else if (status === 'processing') {
                steps[0].classList.add('completed');
                steps[1].classList.add('completed');
                steps[2].classList.add('active');
            } else if (status === 'shipped') {
                steps[0].classList.add('completed');
                steps[1].classList.add('completed');
                steps[2].classList.add('completed');
                steps[3].classList.add('active');
            } else if (status === 'completed') {
                steps.forEach(step => {
                    step.classList.add('completed');
                });
            }
        }

        // Update dashboard stats
        function updateDashboardStats() {
            // Calculate total revenue
            const totalRevenue = ordersData.reduce((sum, order) => sum + order.total, 0);
            document.getElementById('totalRevenue').textContent = `$${totalRevenue.toFixed(2)}`;
            
            // Calculate new orders (last 7 days)
            const sevenDaysAgo = new Date();
            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
            const newOrders = ordersData.filter(order => new Date(order.order_timestamp) >= sevenDaysAgo).length;
            document.getElementById('newOrders').textContent = newOrders;
            
            // Calculate products sold
            const productsSold = ordersData.reduce((sum, order) => {
                return sum + order.items.reduce((itemSum, item) => itemSum + item.quantity, 0);
            }, 0);
            document.getElementById('productsSold').textContent = productsSold;
            
            // Calculate new customers (last 7 days)
            const customerEmails = new Set();
            ordersData.forEach(order => {
                if (new Date(order.order_timestamp) >= sevenDaysAgo) {
                    customerEmails.add(order.customer_info.email);
                }
            });
            document.getElementById('newCustomers').textContent = customerEmails.size;
            
            // For demo purposes, set random changes
            document.getElementById('revenueChange').textContent = '+12.5% from last week';
            document.getElementById('ordersChange').textContent = '+8.3% from last week';
            document.getElementById('productsChange').textContent = '+5.7% from last week';
            document.getElementById('customersChange').textContent = '+3.2% from last week';
        }

        // Update analytics stats
        function updateAnalyticsStats() {
            const range = document.getElementById('analyticsRange').value;
            let days;
            
            if (range === '7days') {
                days = 7;
            } else if (range === 'month') {
                days = 30;
            } else {
                days = 365;
            }
            
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - days);
            
            // Filter orders by date range
            const filteredOrders = ordersData.filter(order => new Date(order.order_timestamp) >= startDate);
            
            // Calculate metrics
            const totalVisitors = Math.floor(filteredOrders.length * 10 * (0.8 + Math.random() * 0.4));
            const conversionRate = (filteredOrders.length / totalVisitors * 100).toFixed(1);
            const avgOrderValue = filteredOrders.length > 0 
                ? filteredOrders.reduce((sum, order) => sum + order.total, 0) / filteredOrders.length 
                : 0;
            
            // Count returning customers
            const customerEmails = new Set();
            const returningCustomers = new Set();
            filteredOrders.forEach(order => {
                if (customerEmails.has(order.customer_info.email)) {
                    returningCustomers.add(order.customer_info.email);
                } else {
                    customerEmails.add(order.customer_info.email);
                }
            });
            
            // Update UI
            document.getElementById('totalVisitors').textContent = totalVisitors.toLocaleString();
            document.getElementById('conversionRate').textContent = `${conversionRate}%`;
            document.getElementById('avgOrderValue').textContent = `$${avgOrderValue.toFixed(2)}`;
            document.getElementById('returningCustomers').textContent = returningCustomers.size;
            
            // For demo purposes, set random changes
            document.getElementById('visitorsChange').textContent = days === 7 ? '+15.2% from last week' : 
                days === 30 ? '+22.8% from last month' : '+18.3% from last year';
            document.getElementById('conversionChange').textContent = days === 7 ? '+2.1% from last week' : 
                days === 30 ? '+3.7% from last month' : '+4.5% from last year';
            document.getElementById('avgOrderChange').textContent = days === 7 ? '+5.3% from last week' : 
                days === 30 ? '+7.9% from last month' : '+9.2% from last year';
            document.getElementById('returningChange').textContent = days === 7 ? '+8.6% from last week' : 
                days === 30 ? '+12.4% from last month' : '+15.7% from last year';
        }

        // Initialize charts
        function initCharts() {
            // Destroy existing charts if they exist
            Object.values(charts).forEach(chart => {
                if (chart) chart.destroy();
            });
            
            // Sales performance chart (line chart)
            const salesCtx = document.getElementById('salesChart').getContext('2d');
            charts.salesChart = new Chart(salesCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
                    datasets: [{
                        label: 'Sales',
                        data: [12000, 19000, 15000, 18000, 21000, 25000, 22000],
                        borderColor: 'var(--gold)',
                        backgroundColor: 'rgba(200, 182, 135, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
            
            // Revenue by category chart (doughnut chart)
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            charts.revenueChart = new Chart(revenueCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Clothing', 'Footwear', 'Jewellery', 'Accessories', 'Beauty'],
                    datasets: [{
                        data: [35, 25, 15, 15, 10],
                        backgroundColor: [
                            'var(--gold)',
                            'var(--dark-gold)',
                            'var(--light-gold)',
                            'var(--taupe)',
                            'var(--cream)'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    },
                    cutout: '70%'
                }
            });
            
            // Traffic sources chart (pie chart)
            const trafficCtx = document.getElementById('trafficChart').getContext('2d');
            charts.trafficChart = new Chart(trafficCtx, {
                type: 'pie',
                data: {
                    labels: ['Direct', 'Social', 'Email', 'Referral', 'Organic'],
                    datasets: [{
                        data: [30, 20, 15, 15, 20],
                        backgroundColor: [
                            'var(--gold)',
                            'var(--dark-gold)',
                            'var(--light-gold)',
                                                        'var(--taupe)',
                            'var(--cream)'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
            
            // Top products chart (bar chart)
            const topProductsCtx = document.getElementById('topProductsChart').getContext('2d');
            charts.topProductsChart = new Chart(topProductsCtx, {
                type: 'bar',
                data: {
                    labels: ['Summer Dress', 'Leather Boots', 'Silk Scarf', 'Gold Necklace', 'Perfume'],
                    datasets: [{
                        label: 'Sales',
                        data: [120, 85, 65, 50, 45],
                        backgroundColor: 'var(--gold)',
                        borderWidth: 0,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
            
            // Customer locations chart (horizontal bar chart)
            const locationsCtx = document.getElementById('locationsChart').getContext('2d');
            charts.locationsChart = new Chart(locationsCtx, {
                type: 'bar',
                data: {
                    labels: ['United States', 'United Kingdom', 'Canada', 'Australia', 'Germany'],
                    datasets: [{
                        label: 'Customers',
                        data: [320, 180, 120, 90, 70],
                        backgroundColor: 'var(--gold)',
                        borderWidth: 0,
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        y: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
            
            // Populate sales data table
            const salesTableBody = document.getElementById('salesTableBody');
            salesTableBody.innerHTML = '';
            
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'];
            months.forEach((month, index) => {
                const row = document.createElement('tr');
                const orders = Math.floor(50 + Math.random() * 30);
                const revenue = orders * (80 + Math.random() * 40);
                const productsSold = Math.floor(orders * (1.5 + Math.random() * 0.5));
                const newCustomers = Math.floor(orders * 0.7);
                
                row.innerHTML = `
                    <td>${month} 2023</td>
                    <td>${orders}</td>
                    <td>$${revenue.toFixed(2)}</td>
                    <td>${productsSold}</td>
                    <td>${newCustomers}</td>
                `;
                salesTableBody.appendChild(row);
            });
        }

        // Show modal
        function showModal(modal) {
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Hide modal
        function hideModal(modal) {
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }

        // Show toast notification
        function showToast(message, type) {
            const toast = document.createElement('div');
            toast.className = `toast show ${type}`;
            toast.innerHTML = `
                <span>${message}</span>
                <button class="toast-close">&times;</button>
            `;
            
            toastContainer.appendChild(toast);
            
            // Add event listener to close button
            toast.querySelector('.toast-close').addEventListener('click', function() {
                toast.classList.remove('show');
                toast.classList.add('hide');
                setTimeout(() => toast.remove(), 300);
            });
            
            // Auto-remove after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                toast.classList.add('hide');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Show loading state
        function showLoading(container) {
            container.innerHTML = `
                <div style="display: flex; justify-content: center; padding: 2rem;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: var(--taupe);"></i>
                </div>
            `;
        }

        // Show error state
        function showError(container, message) {
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-exclamation-circle"></i>
                    <h3>Error</h3>
                    <p>${message}</p>
                    <button class="btn" style="margin-top: 1rem;" onclick="window.location.reload()">Try Again</button>
                </div>
            `;
        }

        // Show empty state
        function showEmptyState(container, title, message) {
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-box-open"></i>
                    <h3>${title}</h3>
                    <p>${message}</p>
                </div>
            `;
        }

        // Format date
        function formatDate(date) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        // Get time ago string
        function getTimeAgo(date) {
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            if (diffInSeconds < 60) {
                return `${diffInSeconds} seconds ago`;
            }
            
            const diffInMinutes = Math.floor(diffInSeconds / 60);
            if (diffInMinutes < 60) {
                return `${diffInMinutes} minute${diffInMinutes === 1 ? '' : 's'} ago`;
            }
            
            const diffInHours = Math.floor(diffInMinutes / 60);
            if (diffInHours < 24) {
                return `${diffInHours} hour${diffInHours === 1 ? '' : 's'} ago`;
            }
            
            const diffInDays = Math.floor(diffInHours / 24);
            return `${diffInDays} day${diffInDays === 1 ? '' : 's'} ago`;
        }

        // Capitalize first letter
        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        // Drag and drop helpers
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function highlight(e) {
            e.currentTarget.style.borderColor = 'var(--gold)';
            e.currentTarget.style.backgroundColor = 'rgba(200, 182, 135, 0.1)';
        }

        function unhighlight(e) {
            e.currentTarget.style.borderColor = '#ddd';
            e.currentTarget.style.backgroundColor = '';
        }
    </script>
</body>
</html>
